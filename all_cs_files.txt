using System;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Threading.Tasks;
using System.Windows;

namespace UP
{
    /// <summary>
    /// Логика взаимодействия для App.xaml
    /// </summary>
    public partial class App : Application
    {
    }
}
﻿using System.Windows;
using System.Windows.Controls;
using UP.Pages;
using UP.Services;

namespace UP
{
    public partial class MainWindow : Window
    {
        public static MainWindow mainWindow;

        public MainWindow()
        {
            InitializeComponent();
            mainWindow = this;

            // Настройка API
            AppData.ApiService = new ApiService("https://localhost:7197/api/");

            OpenPages(new LogInPage());
        }

        public void OpenPages(Page page)
        {
            frame.Navigate(page);

            if (page is FrameworkElement frameworkElement)
            {
                frameworkElement.HorizontalAlignment = HorizontalAlignment.Stretch;
                frameworkElement.VerticalAlignment = VerticalAlignment.Stretch;
            }
        }
    }
}﻿// Исправление в AppData.cs - добавление недостающих моделей
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using System.Windows;
using UP.Models;
using UP.Pages;
using UP.Services;

namespace UP
{
    public static class AppData
    {
        public static ApiService ApiService { get; set; } = new ApiService();
        public static UserData CurrentUser { get; set; }

        public static ObservableCollection<string> Products { get; set; } = new ObservableCollection<string>();
        public static ObservableCollection<Receipts.DailyMenu> WeeklyMenu { get; set; } = new ObservableCollection<Receipts.DailyMenu>();
        public static ObservableCollection<string> ShoppingList { get; set; } = new ObservableCollection<string>();
        public static ObservableCollection<RecipeDetailsPage.RecipeData> Favorites { get; set; } = new ObservableCollection<RecipeDetailsPage.RecipeData>();
        public static ObservableCollection<RecipeDto> AllRecipes { get; set; } = new ObservableCollection<RecipeDto>();

        public static async void InitializeAfterLogin(UserData user)
        {
            CurrentUser = user;
            await LoadInitialData();
        }

        public static async Task LoadInitialData()
        {
            try
            {
                await LoadRecipes();
                await LoadFavorites();
                await LoadCurrentMenu();
                await LoadShoppingList();
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Ошибка загрузки данных: {ex.Message}", "Ошибка");
            }
        }

        public static async Task LoadRecipes()
        {
            try
            {
                var recipes = await ApiService.GetRecipesAsync();
                AllRecipes.Clear();

                foreach (var recipe in recipes)
                {
                    AllRecipes.Add(recipe);
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error loading recipes: {ex.Message}");
            }
        }

        public static async Task LoadFavorites()
        {
            try
            {
                var favorites = await ApiService.GetFavoritesAsync();
                Favorites.Clear();

                foreach (var recipe in favorites)
                {
                    Favorites.Add(ConvertToRecipeData(recipe));
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error loading favorites: {ex.Message}");
            }
        }

        public static async Task LoadCurrentMenu()
        {
            try
            {
                var menu = await ApiService.GetCurrentMenuAsync();
                WeeklyMenu.Clear();

                if (menu != null && menu.Days != null)
                {
                    foreach (var day in menu.Days)
                    {
                        foreach (var meal in day.Meals)
                        {
                            WeeklyMenu.Add(new Receipts.DailyMenu
                            {
                                Day = day.Date,
                                Meal = meal.RecipeTitle,
                                Description = $"Калории: {meal.Calories} | Время: {meal.PrepTime} мин",
                                RecipeId = meal.RecipeId
                            });
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error loading menu: {ex.Message}");
            }
        }

        public static async Task LoadShoppingList()
        {
            try
            {
                var shoppingList = await ApiService.GetCurrentShoppingListAsync();
                ShoppingList.Clear();

                if (shoppingList != null && shoppingList.Items != null)
                {
                    foreach (var item in shoppingList.Items)
                    {
                        if (!item.IsPurchased)
                        {
                            ShoppingList.Add($"{item.IngredientName} - {item.Quantity} {item.Unit}");
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error loading shopping list: {ex.Message}");
            }
        }

        public static async Task<bool> AddToFavorites(RecipeDetailsPage.RecipeData recipe)
        {
            try
            {
                var apiRecipe = AllRecipes.FirstOrDefault(r => r.Title == recipe.Title);
                if (apiRecipe != null)
                {
                    return await ApiService.ToggleFavoriteAsync(apiRecipe.Id);
                }
                return false;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error adding to favorites: {ex.Message}");
                return false;
            }
        }

        public static async Task<bool> RemoveFromFavorites(RecipeDetailsPage.RecipeData recipe)
        {
            try
            {
                var apiRecipe = AllRecipes.FirstOrDefault(r => r.Title == recipe.Title);
                if (apiRecipe != null)
                {
                    return await ApiService.ToggleFavoriteAsync(apiRecipe.Id);
                }
                return false;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error removing from favorites: {ex.Message}");
                return false;
            }
        }

        public static async Task<bool> GenerateNewMenu(GenerateMenuRequest request)
        {
            try
            {
                Console.WriteLine($"Generating menu with request: Days={request.Days}, Calories={request.TargetCaloriesPerDay}, Tags={string.Join(", ", request.CuisineTags)}");

                var menu = await ApiService.GenerateMenuAsync(request);

                Console.WriteLine($"Menu generation response: {(menu != null ? "Success" : "Null response")}");

                if (menu != null)
                {
                    Console.WriteLine($"Menu ID: {menu.Id}, Days count: {menu.Days?.Count}");

                    if (menu.Days != null && menu.Days.Count > 0)
                    {
                        await LoadCurrentMenu();

                        if (menu.Id > 0)
                        {
                            Console.WriteLine($"Generating shopping list for menu ID: {menu.Id}");
                            await ApiService.GenerateShoppingListAsync(menu.Id);
                            await LoadShoppingList();
                        }
                        return true;
                    }
                    else
                    {
                        Console.WriteLine("Menu generated but has no days");
                        return false;
                    }
                }
                return false;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error generating menu: {ex.Message}");
                Console.WriteLine($"Stack trace: {ex.StackTrace}");
                return false;
            }
        }

        private static RecipeDetailsPage.RecipeData ConvertToRecipeData(RecipeDto recipe)
        {
            return new RecipeDetailsPage.RecipeData
            {
                Title = recipe.Title,
                Description = recipe.Description,
                ImageUrl = recipe.ImageUrl,
                Ingredients = recipe.Ingredients?.ConvertAll(i => $"{i.Name} - {i.Quantity} {i.Unit}") ?? new List<string>(),
                Steps = recipe.Instructions ?? new List<string>()
            };
        }

        public static void Logout()
        {
            CurrentUser = null;
            ApiService.ClearToken();

            Products.Clear();
            WeeklyMenu.Clear();
            ShoppingList.Clear();
            Favorites.Clear();
            AllRecipes.Clear();
        }
    }
}﻿using System.Collections.Generic;
using System.Collections.ObjectModel;

namespace UP.Models
{
    public class LoginRequest
    {
        public string Username { get; set; }
        public string Password { get; set; }
    }

    public class RegisterRequest
    {
        public string Username { get; set; }
        public string Email { get; set; }
        public string Password { get; set; }
        public List<string> Allergies { get; set; } = new List<string>();
    }

    public class AuthResponse
    {
        public bool Success { get; set; }
        public string Message { get; set; }
        public UserData Data { get; set; }
    }

    public class UserData
    {
        public int Id { get; set; }
        public string Username { get; set; }
        public string Email { get; set; }
        public string FullName { get; set; }
        public string Token { get; set; }
    }

    public class RecipeDto
    {
        public int Id { get; set; }
        public string Title { get; set; }
        public string Description { get; set; }
        public string ImageUrl { get; set; }
        public int PrepTime { get; set; }
        public int CookTime { get; set; }
        public decimal Calories { get; set; }
        public List<IngredientDto> Ingredients { get; set; } = new List<IngredientDto>();
        public List<string> Instructions { get; set; } = new List<string>();
        public string CuisineType { get; set; }
        public string Difficulty { get; set; }
    }

    public class IngredientDto
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public decimal Quantity { get; set; }
        public string Unit { get; set; }
        public string Category { get; set; }
    }

    public class GenerateMenuRequest
    {
        public int Days { get; set; } = 7;
        public decimal? TargetCaloriesPerDay { get; set; }
        public List<string> CuisineTags { get; set; } = new List<string>();
        public List<string> MealTypes { get; set; } = new List<string> { "breakfast", "lunch", "dinner" };
        public bool UseInventory { get; set; } = false;
    }

    public class MenuDto
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public decimal TotalCalories { get; set; }
        public List<MenuDayDto> Days { get; set; } = new List<MenuDayDto>();
    }

    public class MenuDayDto
    {
        public string Date { get; set; }
        public List<MenuMealDto> Meals { get; set; } = new List<MenuMealDto>();
    }

    public class MenuMealDto
    {
        public int Id { get; set; }
        public int RecipeId { get; set; }
        public string RecipeTitle { get; set; }
        public string MealType { get; set; }
        public decimal Calories { get; set; }
        public int PrepTime { get; set; }
        public string ImageUrl { get; set; }
    }

    public class ShoppingListDto
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public bool IsCompleted { get; set; }
        public List<ShoppingListItemDto> Items { get; set; } = new List<ShoppingListItemDto>();
    }

    public class ShoppingListItemDto
    {
        public int Id { get; set; }
        public string IngredientName { get; set; }
        public decimal Quantity { get; set; }
        public string Unit { get; set; }
        public string Category { get; set; }
        public bool IsPurchased { get; set; }
    }
}// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETFramework,Version=v4.7.2", FrameworkDisplayName = ".NET Framework 4.7.2")]
﻿#pragma checksum "..\..\App.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "59C6E7EBEF07C7464503EDEE481DBC704FD9C67A67A4798EB6A2D4C5EECF618C"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;
using UP;


namespace UP {
    
    
    /// <summary>
    /// App
    /// </summary>
    public partial class App : System.Windows.Application {
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            
            #line 5 "..\..\App.xaml"
            this.StartupUri = new System.Uri("MainWindow.xaml", System.UriKind.Relative);
            
            #line default
            #line hidden
        }
        
        /// <summary>
        /// Application Entry Point.
        /// </summary>
        [System.STAThreadAttribute()]
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public static void Main() {
            UP.App app = new UP.App();
            app.InitializeComponent();
            app.Run();
        }
    }
}

﻿#pragma checksum "..\..\App.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "59C6E7EBEF07C7464503EDEE481DBC704FD9C67A67A4798EB6A2D4C5EECF618C"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;
using UP;


namespace UP {
    
    
    /// <summary>
    /// App
    /// </summary>
    public partial class App : System.Windows.Application {
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            
            #line 5 "..\..\App.xaml"
            this.StartupUri = new System.Uri("MainWindow.xaml", System.UriKind.Relative);
            
            #line default
            #line hidden
        }
        
        /// <summary>
        /// Application Entry Point.
        /// </summary>
        [System.STAThreadAttribute()]
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public static void Main() {
            UP.App app = new UP.App();
            app.InitializeComponent();
            app.Run();
        }
    }
}

﻿#pragma checksum "..\..\MainWindow.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "57B0F1AB726BA964D4384C2E3267436C082E830B693F52B35C3BD256355F725A"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;
using UP;


namespace UP {
    
    
    /// <summary>
    /// MainWindow
    /// </summary>
    public partial class MainWindow : System.Windows.Window, System.Windows.Markup.IComponentConnector {
        
        
        #line 11 "..\..\MainWindow.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Frame frame;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/UP;component/mainwindow.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\MainWindow.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            this.frame = ((System.Windows.Controls.Frame)(target));
            return;
            }
            this._contentLoaded = true;
        }
    }
}

﻿#pragma checksum "..\..\MainWindow.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "57B0F1AB726BA964D4384C2E3267436C082E830B693F52B35C3BD256355F725A"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;
using UP;


namespace UP {
    
    
    /// <summary>
    /// MainWindow
    /// </summary>
    public partial class MainWindow : System.Windows.Window, System.Windows.Markup.IComponentConnector {
        
        
        #line 11 "..\..\MainWindow.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Frame frame;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/UP;component/mainwindow.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\MainWindow.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            this.frame = ((System.Windows.Controls.Frame)(target));
            return;
            }
            this._contentLoaded = true;
        }
    }
}

﻿//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

[assembly: System.Windows.Resources.AssemblyAssociatedContentFileAttribute("images/scary.jpg")]


﻿//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

[assembly: System.Windows.Resources.AssemblyAssociatedContentFileAttribute("images/scary.jpg")]


﻿#pragma checksum "..\..\..\Pages\FavoritesPage.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "B57B879EB1A4D945BAFEE9F657E4FAF9BCEA2AC7A9CB49B7F5867266A931BE9B"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace UP.Pages {
    
    
    /// <summary>
    /// FavoritesPage
    /// </summary>
    public partial class FavoritesPage : System.Windows.Controls.Page, System.Windows.Markup.IComponentConnector, System.Windows.Markup.IStyleConnector {
        
        
        #line 53 "..\..\..\Pages\FavoritesPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ItemsControl FavoritesList;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/UP;component/pages/favoritespage.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\Pages\FavoritesPage.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            
            #line 42 "..\..\..\Pages\FavoritesPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.BackButton_Click);
            
            #line default
            #line hidden
            return;
            case 2:
            this.FavoritesList = ((System.Windows.Controls.ItemsControl)(target));
            return;
            }
            this._contentLoaded = true;
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        void System.Windows.Markup.IStyleConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 3:
            
            #line 95 "..\..\..\Pages\FavoritesPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.OpenRecipe_Click);
            
            #line default
            #line hidden
            break;
            case 4:
            
            #line 104 "..\..\..\Pages\FavoritesPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.RemoveRecipe_Click);
            
            #line default
            #line hidden
            break;
            }
        }
    }
}

﻿#pragma checksum "..\..\..\Pages\FavoritesPage.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "B57B879EB1A4D945BAFEE9F657E4FAF9BCEA2AC7A9CB49B7F5867266A931BE9B"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace UP.Pages {
    
    
    /// <summary>
    /// FavoritesPage
    /// </summary>
    public partial class FavoritesPage : System.Windows.Controls.Page, System.Windows.Markup.IComponentConnector, System.Windows.Markup.IStyleConnector {
        
        
        #line 53 "..\..\..\Pages\FavoritesPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ItemsControl FavoritesList;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/UP;component/pages/favoritespage.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\Pages\FavoritesPage.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            
            #line 42 "..\..\..\Pages\FavoritesPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.BackButton_Click);
            
            #line default
            #line hidden
            return;
            case 2:
            this.FavoritesList = ((System.Windows.Controls.ItemsControl)(target));
            return;
            }
            this._contentLoaded = true;
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        void System.Windows.Markup.IStyleConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 3:
            
            #line 95 "..\..\..\Pages\FavoritesPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.OpenRecipe_Click);
            
            #line default
            #line hidden
            break;
            case 4:
            
            #line 104 "..\..\..\Pages\FavoritesPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.RemoveRecipe_Click);
            
            #line default
            #line hidden
            break;
            }
        }
    }
}

﻿#pragma checksum "..\..\..\Pages\LogInPage.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "3E4A75613654FD92FAA439A52A2C6C0B23B2591804F2E62AA66DFBC5001D5E78"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace UP.Pages {
    
    
    /// <summary>
    /// LogInPage
    /// </summary>
    public partial class LogInPage : System.Windows.Controls.Page, System.Windows.Markup.IComponentConnector {
        
        
        #line 68 "..\..\..\Pages\LogInPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBox SecretCodeBox;
        
        #line default
        #line hidden
        
        
        #line 90 "..\..\..\Pages\LogInPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBox UsernameTextBox;
        
        #line default
        #line hidden
        
        
        #line 101 "..\..\..\Pages\LogInPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.PasswordBox PasswordBox;
        
        #line default
        #line hidden
        
        
        #line 122 "..\..\..\Pages\LogInPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button LoginButton;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/UP;component/pages/loginpage.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\Pages\LogInPage.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            this.SecretCodeBox = ((System.Windows.Controls.TextBox)(target));
            
            #line 76 "..\..\..\Pages\LogInPage.xaml"
            this.SecretCodeBox.KeyDown += new System.Windows.Input.KeyEventHandler(this.SecretCodeBox_KeyDown);
            
            #line default
            #line hidden
            return;
            case 2:
            this.UsernameTextBox = ((System.Windows.Controls.TextBox)(target));
            return;
            case 3:
            this.PasswordBox = ((System.Windows.Controls.PasswordBox)(target));
            return;
            case 4:
            this.LoginButton = ((System.Windows.Controls.Button)(target));
            
            #line 126 "..\..\..\Pages\LogInPage.xaml"
            this.LoginButton.Click += new System.Windows.RoutedEventHandler(this.LoginButton_Click);
            
            #line default
            #line hidden
            return;
            case 5:
            
            #line 135 "..\..\..\Pages\LogInPage.xaml"
            ((System.Windows.Controls.TextBlock)(target)).MouseLeftButtonDown += new System.Windows.Input.MouseButtonEventHandler(this.RegisterText_MouseLeftButtonDown);
            
            #line default
            #line hidden
            return;
            }
            this._contentLoaded = true;
        }
    }
}

﻿#pragma checksum "..\..\..\Pages\LogInPage.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "3E4A75613654FD92FAA439A52A2C6C0B23B2591804F2E62AA66DFBC5001D5E78"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace UP.Pages {
    
    
    /// <summary>
    /// LogInPage
    /// </summary>
    public partial class LogInPage : System.Windows.Controls.Page, System.Windows.Markup.IComponentConnector {
        
        
        #line 68 "..\..\..\Pages\LogInPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBox SecretCodeBox;
        
        #line default
        #line hidden
        
        
        #line 90 "..\..\..\Pages\LogInPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBox UsernameTextBox;
        
        #line default
        #line hidden
        
        
        #line 101 "..\..\..\Pages\LogInPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.PasswordBox PasswordBox;
        
        #line default
        #line hidden
        
        
        #line 122 "..\..\..\Pages\LogInPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button LoginButton;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/UP;component/pages/loginpage.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\Pages\LogInPage.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            this.SecretCodeBox = ((System.Windows.Controls.TextBox)(target));
            
            #line 76 "..\..\..\Pages\LogInPage.xaml"
            this.SecretCodeBox.KeyDown += new System.Windows.Input.KeyEventHandler(this.SecretCodeBox_KeyDown);
            
            #line default
            #line hidden
            return;
            case 2:
            this.UsernameTextBox = ((System.Windows.Controls.TextBox)(target));
            return;
            case 3:
            this.PasswordBox = ((System.Windows.Controls.PasswordBox)(target));
            return;
            case 4:
            this.LoginButton = ((System.Windows.Controls.Button)(target));
            
            #line 126 "..\..\..\Pages\LogInPage.xaml"
            this.LoginButton.Click += new System.Windows.RoutedEventHandler(this.LoginButton_Click);
            
            #line default
            #line hidden
            return;
            case 5:
            
            #line 135 "..\..\..\Pages\LogInPage.xaml"
            ((System.Windows.Controls.TextBlock)(target)).MouseLeftButtonDown += new System.Windows.Input.MouseButtonEventHandler(this.RegisterText_MouseLeftButtonDown);
            
            #line default
            #line hidden
            return;
            }
            this._contentLoaded = true;
        }
    }
}

﻿#pragma checksum "..\..\..\Pages\ReceiptDetailPage.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "46A0E84F936389FF6C4E7C0A4CC8D21A99228C1847E6C9D0D906BE17A25C24CE"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace UP.Pages {
    
    
    /// <summary>
    /// RecipeDetailsPage
    /// </summary>
    public partial class RecipeDetailsPage : System.Windows.Controls.Page, System.Windows.Markup.IComponentConnector {
        
        
        #line 67 "..\..\..\Pages\ReceiptDetailPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBlock RecipeTitleText;
        
        #line default
        #line hidden
        
        
        #line 73 "..\..\..\Pages\ReceiptDetailPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Image RecipeImage;
        
        #line default
        #line hidden
        
        
        #line 78 "..\..\..\Pages\ReceiptDetailPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBlock RecipeDescriptionText;
        
        #line default
        #line hidden
        
        
        #line 95 "..\..\..\Pages\ReceiptDetailPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ItemsControl IngredientsList;
        
        #line default
        #line hidden
        
        
        #line 113 "..\..\..\Pages\ReceiptDetailPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ItemsControl StepsList;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/UP;component/pages/receiptdetailpage.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\Pages\ReceiptDetailPage.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            
            #line 51 "..\..\..\Pages\ReceiptDetailPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.BackButton_Click);
            
            #line default
            #line hidden
            return;
            case 2:
            this.RecipeTitleText = ((System.Windows.Controls.TextBlock)(target));
            return;
            case 3:
            this.RecipeImage = ((System.Windows.Controls.Image)(target));
            return;
            case 4:
            this.RecipeDescriptionText = ((System.Windows.Controls.TextBlock)(target));
            return;
            case 5:
            this.IngredientsList = ((System.Windows.Controls.ItemsControl)(target));
            return;
            case 6:
            this.StepsList = ((System.Windows.Controls.ItemsControl)(target));
            return;
            case 7:
            
            #line 138 "..\..\..\Pages\ReceiptDetailPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.StartTimer_Click);
            
            #line default
            #line hidden
            return;
            case 8:
            
            #line 139 "..\..\..\Pages\ReceiptDetailPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.AddToShoppingList_Click);
            
            #line default
            #line hidden
            return;
            case 9:
            
            #line 140 "..\..\..\Pages\ReceiptDetailPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.AddToFavorites_Click);
            
            #line default
            #line hidden
            return;
            }
            this._contentLoaded = true;
        }
    }
}

﻿#pragma checksum "..\..\..\Pages\ReceiptDetailPage.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "46A0E84F936389FF6C4E7C0A4CC8D21A99228C1847E6C9D0D906BE17A25C24CE"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace UP.Pages {
    
    
    /// <summary>
    /// RecipeDetailsPage
    /// </summary>
    public partial class RecipeDetailsPage : System.Windows.Controls.Page, System.Windows.Markup.IComponentConnector {
        
        
        #line 67 "..\..\..\Pages\ReceiptDetailPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBlock RecipeTitleText;
        
        #line default
        #line hidden
        
        
        #line 73 "..\..\..\Pages\ReceiptDetailPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Image RecipeImage;
        
        #line default
        #line hidden
        
        
        #line 78 "..\..\..\Pages\ReceiptDetailPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBlock RecipeDescriptionText;
        
        #line default
        #line hidden
        
        
        #line 95 "..\..\..\Pages\ReceiptDetailPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ItemsControl IngredientsList;
        
        #line default
        #line hidden
        
        
        #line 113 "..\..\..\Pages\ReceiptDetailPage.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ItemsControl StepsList;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/UP;component/pages/receiptdetailpage.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\Pages\ReceiptDetailPage.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            
            #line 51 "..\..\..\Pages\ReceiptDetailPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.BackButton_Click);
            
            #line default
            #line hidden
            return;
            case 2:
            this.RecipeTitleText = ((System.Windows.Controls.TextBlock)(target));
            return;
            case 3:
            this.RecipeImage = ((System.Windows.Controls.Image)(target));
            return;
            case 4:
            this.RecipeDescriptionText = ((System.Windows.Controls.TextBlock)(target));
            return;
            case 5:
            this.IngredientsList = ((System.Windows.Controls.ItemsControl)(target));
            return;
            case 6:
            this.StepsList = ((System.Windows.Controls.ItemsControl)(target));
            return;
            case 7:
            
            #line 138 "..\..\..\Pages\ReceiptDetailPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.StartTimer_Click);
            
            #line default
            #line hidden
            return;
            case 8:
            
            #line 139 "..\..\..\Pages\ReceiptDetailPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.AddToShoppingList_Click);
            
            #line default
            #line hidden
            return;
            case 9:
            
            #line 140 "..\..\..\Pages\ReceiptDetailPage.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.AddToFavorites_Click);
            
            #line default
            #line hidden
            return;
            }
            this._contentLoaded = true;
        }
    }
}

﻿#pragma checksum "..\..\..\Pages\Receipts.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "9C3DC0E618CC1C622514BB425882FCA3C4E5BC0C3FEAE0285BBBFEF5EFE30D73"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;
using UP.Pages;


namespace UP.Pages {
    
    
    /// <summary>
    /// Receipts
    /// </summary>
    public partial class Receipts : System.Windows.Controls.Page, System.Windows.Markup.IComponentConnector, System.Windows.Markup.IStyleConnector {
        
        
        #line 107 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBox NewProductTextBox;
        
        #line default
        #line hidden
        
        
        #line 119 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ListView ProductsListView;
        
        #line default
        #line hidden
        
        
        #line 157 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.CheckBox GlutenCheckBox;
        
        #line default
        #line hidden
        
        
        #line 161 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.CheckBox LactoseCheckBox;
        
        #line default
        #line hidden
        
        
        #line 165 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.CheckBox NutsCheckBox;
        
        #line default
        #line hidden
        
        
        #line 169 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.CheckBox SeafoodCheckBox;
        
        #line default
        #line hidden
        
        
        #line 176 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBox OtherAllergiesTextBox;
        
        #line default
        #line hidden
        
        
        #line 188 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button GenerateMenuButton;
        
        #line default
        #line hidden
        
        
        #line 211 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ItemsControl WeeklyMenuItemsControl;
        
        #line default
        #line hidden
        
        
        #line 267 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ItemsControl ActiveTimersItemsControl;
        
        #line default
        #line hidden
        
        
        #line 299 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBlock NoTimersText;
        
        #line default
        #line hidden
        
        
        #line 322 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ListView ShoppingListListView;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/UP;component/pages/receipts.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\Pages\Receipts.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            
            #line 80 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.OpenFavorites_Click);
            
            #line default
            #line hidden
            return;
            case 2:
            this.NewProductTextBox = ((System.Windows.Controls.TextBox)(target));
            return;
            case 3:
            
            #line 117 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.AddProduct_Click);
            
            #line default
            #line hidden
            return;
            case 4:
            this.ProductsListView = ((System.Windows.Controls.ListView)(target));
            return;
            case 6:
            this.GlutenCheckBox = ((System.Windows.Controls.CheckBox)(target));
            return;
            case 7:
            this.LactoseCheckBox = ((System.Windows.Controls.CheckBox)(target));
            return;
            case 8:
            this.NutsCheckBox = ((System.Windows.Controls.CheckBox)(target));
            return;
            case 9:
            this.SeafoodCheckBox = ((System.Windows.Controls.CheckBox)(target));
            return;
            case 10:
            this.OtherAllergiesTextBox = ((System.Windows.Controls.TextBox)(target));
            
            #line 183 "..\..\..\Pages\Receipts.xaml"
            this.OtherAllergiesTextBox.TextChanged += new System.Windows.Controls.TextChangedEventHandler(this.OtherAllergiesTextBox_TextChanged);
            
            #line default
            #line hidden
            return;
            case 11:
            this.GenerateMenuButton = ((System.Windows.Controls.Button)(target));
            
            #line 194 "..\..\..\Pages\Receipts.xaml"
            this.GenerateMenuButton.Click += new System.Windows.RoutedEventHandler(this.GenerateMenu_Click);
            
            #line default
            #line hidden
            return;
            case 12:
            
            #line 202 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.RefreshData_Click);
            
            #line default
            #line hidden
            return;
            case 13:
            this.WeeklyMenuItemsControl = ((System.Windows.Controls.ItemsControl)(target));
            return;
            case 16:
            this.ActiveTimersItemsControl = ((System.Windows.Controls.ItemsControl)(target));
            return;
            case 18:
            this.NoTimersText = ((System.Windows.Controls.TextBlock)(target));
            return;
            case 19:
            this.ShoppingListListView = ((System.Windows.Controls.ListView)(target));
            return;
            case 21:
            
            #line 339 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.ExportShoppingList_Click);
            
            #line default
            #line hidden
            return;
            case 22:
            
            #line 356 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.BackButton_Click);
            
            #line default
            #line hidden
            return;
            }
            this._contentLoaded = true;
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        void System.Windows.Markup.IStyleConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 5:
            
            #line 140 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.RemoveProduct_Click);
            
            #line default
            #line hidden
            break;
            case 14:
            
            #line 237 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.StartTimer_Click);
            
            #line default
            #line hidden
            break;
            case 15:
            
            #line 246 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.OpenRecipe_Click);
            
            #line default
            #line hidden
            break;
            case 17:
            
            #line 292 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.StopTimer_Click);
            
            #line default
            #line hidden
            break;
            case 20:
            
            #line 331 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.CheckBox)(target)).Checked += new System.Windows.RoutedEventHandler(this.ShoppingItem_Checked);
            
            #line default
            #line hidden
            break;
            }
        }
    }
}

﻿#pragma checksum "..\..\..\Pages\Receipts.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "9C3DC0E618CC1C622514BB425882FCA3C4E5BC0C3FEAE0285BBBFEF5EFE30D73"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;
using UP.Pages;


namespace UP.Pages {
    
    
    /// <summary>
    /// Receipts
    /// </summary>
    public partial class Receipts : System.Windows.Controls.Page, System.Windows.Markup.IComponentConnector, System.Windows.Markup.IStyleConnector {
        
        
        #line 107 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBox NewProductTextBox;
        
        #line default
        #line hidden
        
        
        #line 119 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ListView ProductsListView;
        
        #line default
        #line hidden
        
        
        #line 157 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.CheckBox GlutenCheckBox;
        
        #line default
        #line hidden
        
        
        #line 161 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.CheckBox LactoseCheckBox;
        
        #line default
        #line hidden
        
        
        #line 165 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.CheckBox NutsCheckBox;
        
        #line default
        #line hidden
        
        
        #line 169 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.CheckBox SeafoodCheckBox;
        
        #line default
        #line hidden
        
        
        #line 176 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBox OtherAllergiesTextBox;
        
        #line default
        #line hidden
        
        
        #line 188 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.Button GenerateMenuButton;
        
        #line default
        #line hidden
        
        
        #line 211 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ItemsControl WeeklyMenuItemsControl;
        
        #line default
        #line hidden
        
        
        #line 267 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ItemsControl ActiveTimersItemsControl;
        
        #line default
        #line hidden
        
        
        #line 299 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBlock NoTimersText;
        
        #line default
        #line hidden
        
        
        #line 322 "..\..\..\Pages\Receipts.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.ListView ShoppingListListView;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/UP;component/pages/receipts.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\Pages\Receipts.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            
            #line 80 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.OpenFavorites_Click);
            
            #line default
            #line hidden
            return;
            case 2:
            this.NewProductTextBox = ((System.Windows.Controls.TextBox)(target));
            return;
            case 3:
            
            #line 117 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.AddProduct_Click);
            
            #line default
            #line hidden
            return;
            case 4:
            this.ProductsListView = ((System.Windows.Controls.ListView)(target));
            return;
            case 6:
            this.GlutenCheckBox = ((System.Windows.Controls.CheckBox)(target));
            return;
            case 7:
            this.LactoseCheckBox = ((System.Windows.Controls.CheckBox)(target));
            return;
            case 8:
            this.NutsCheckBox = ((System.Windows.Controls.CheckBox)(target));
            return;
            case 9:
            this.SeafoodCheckBox = ((System.Windows.Controls.CheckBox)(target));
            return;
            case 10:
            this.OtherAllergiesTextBox = ((System.Windows.Controls.TextBox)(target));
            
            #line 183 "..\..\..\Pages\Receipts.xaml"
            this.OtherAllergiesTextBox.TextChanged += new System.Windows.Controls.TextChangedEventHandler(this.OtherAllergiesTextBox_TextChanged);
            
            #line default
            #line hidden
            return;
            case 11:
            this.GenerateMenuButton = ((System.Windows.Controls.Button)(target));
            
            #line 194 "..\..\..\Pages\Receipts.xaml"
            this.GenerateMenuButton.Click += new System.Windows.RoutedEventHandler(this.GenerateMenu_Click);
            
            #line default
            #line hidden
            return;
            case 12:
            
            #line 202 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.RefreshData_Click);
            
            #line default
            #line hidden
            return;
            case 13:
            this.WeeklyMenuItemsControl = ((System.Windows.Controls.ItemsControl)(target));
            return;
            case 16:
            this.ActiveTimersItemsControl = ((System.Windows.Controls.ItemsControl)(target));
            return;
            case 18:
            this.NoTimersText = ((System.Windows.Controls.TextBlock)(target));
            return;
            case 19:
            this.ShoppingListListView = ((System.Windows.Controls.ListView)(target));
            return;
            case 21:
            
            #line 339 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.ExportShoppingList_Click);
            
            #line default
            #line hidden
            return;
            case 22:
            
            #line 356 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.BackButton_Click);
            
            #line default
            #line hidden
            return;
            }
            this._contentLoaded = true;
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        void System.Windows.Markup.IStyleConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 5:
            
            #line 140 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.RemoveProduct_Click);
            
            #line default
            #line hidden
            break;
            case 14:
            
            #line 237 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.StartTimer_Click);
            
            #line default
            #line hidden
            break;
            case 15:
            
            #line 246 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.OpenRecipe_Click);
            
            #line default
            #line hidden
            break;
            case 17:
            
            #line 292 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.StopTimer_Click);
            
            #line default
            #line hidden
            break;
            case 20:
            
            #line 331 "..\..\..\Pages\Receipts.xaml"
            ((System.Windows.Controls.CheckBox)(target)).Checked += new System.Windows.RoutedEventHandler(this.ShoppingItem_Checked);
            
            #line default
            #line hidden
            break;
            }
        }
    }
}

﻿#pragma checksum "..\..\..\Pages\RegIn.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "737DDF81BA1078259C253AB077DB5CABDB5567025C18664A3413BDCA7E8C7C45"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace UP.Pages {
    
    
    /// <summary>
    /// RegIn
    /// </summary>
    public partial class RegIn : System.Windows.Controls.Page, System.Windows.Markup.IComponentConnector {
        
        
        #line 87 "..\..\..\Pages\RegIn.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBox UsernameTextBox;
        
        #line default
        #line hidden
        
        
        #line 98 "..\..\..\Pages\RegIn.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBox EmailTextBox;
        
        #line default
        #line hidden
        
        
        #line 109 "..\..\..\Pages\RegIn.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.PasswordBox PasswordBox;
        
        #line default
        #line hidden
        
        
        #line 135 "..\..\..\Pages\RegIn.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.PasswordBox ConfirmPasswordBox;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/UP;component/pages/regin.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\Pages\RegIn.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            this.UsernameTextBox = ((System.Windows.Controls.TextBox)(target));
            return;
            case 2:
            this.EmailTextBox = ((System.Windows.Controls.TextBox)(target));
            return;
            case 3:
            this.PasswordBox = ((System.Windows.Controls.PasswordBox)(target));
            return;
            case 4:
            this.ConfirmPasswordBox = ((System.Windows.Controls.PasswordBox)(target));
            return;
            case 5:
            
            #line 167 "..\..\..\Pages\RegIn.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.RegisterButton_Click);
            
            #line default
            #line hidden
            return;
            case 6:
            
            #line 174 "..\..\..\Pages\RegIn.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.BackButton_Click);
            
            #line default
            #line hidden
            return;
            case 7:
            
            #line 184 "..\..\..\Pages\RegIn.xaml"
            ((System.Windows.Controls.TextBlock)(target)).MouseLeftButtonDown += new System.Windows.Input.MouseButtonEventHandler(this.LoginText_MouseLeftButtonDown);
            
            #line default
            #line hidden
            return;
            }
            this._contentLoaded = true;
        }
    }
}

﻿#pragma checksum "..\..\..\Pages\RegIn.xaml" "{8829d00f-11b8-4213-878b-770e8597ac16}" "737DDF81BA1078259C253AB077DB5CABDB5567025C18664A3413BDCA7E8C7C45"
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Diagnostics;
using System.Windows;
using System.Windows.Automation;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Ink;
using System.Windows.Input;
using System.Windows.Markup;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Media.Effects;
using System.Windows.Media.Imaging;
using System.Windows.Media.Media3D;
using System.Windows.Media.TextFormatting;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Windows.Shell;


namespace UP.Pages {
    
    
    /// <summary>
    /// RegIn
    /// </summary>
    public partial class RegIn : System.Windows.Controls.Page, System.Windows.Markup.IComponentConnector {
        
        
        #line 87 "..\..\..\Pages\RegIn.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBox UsernameTextBox;
        
        #line default
        #line hidden
        
        
        #line 98 "..\..\..\Pages\RegIn.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.TextBox EmailTextBox;
        
        #line default
        #line hidden
        
        
        #line 109 "..\..\..\Pages\RegIn.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.PasswordBox PasswordBox;
        
        #line default
        #line hidden
        
        
        #line 135 "..\..\..\Pages\RegIn.xaml"
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1823:AvoidUnusedPrivateFields")]
        internal System.Windows.Controls.PasswordBox ConfirmPasswordBox;
        
        #line default
        #line hidden
        
        private bool _contentLoaded;
        
        /// <summary>
        /// InitializeComponent
        /// </summary>
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        public void InitializeComponent() {
            if (_contentLoaded) {
                return;
            }
            _contentLoaded = true;
            System.Uri resourceLocater = new System.Uri("/UP;component/pages/regin.xaml", System.UriKind.Relative);
            
            #line 1 "..\..\..\Pages\RegIn.xaml"
            System.Windows.Application.LoadComponent(this, resourceLocater);
            
            #line default
            #line hidden
        }
        
        [System.Diagnostics.DebuggerNonUserCodeAttribute()]
        [System.CodeDom.Compiler.GeneratedCodeAttribute("PresentationBuildTasks", "4.0.0.0")]
        [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Never)]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Design", "CA1033:InterfaceMethodsShouldBeCallableByChildTypes")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Maintainability", "CA1502:AvoidExcessiveComplexity")]
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1800:DoNotCastUnnecessarily")]
        void System.Windows.Markup.IComponentConnector.Connect(int connectionId, object target) {
            switch (connectionId)
            {
            case 1:
            this.UsernameTextBox = ((System.Windows.Controls.TextBox)(target));
            return;
            case 2:
            this.EmailTextBox = ((System.Windows.Controls.TextBox)(target));
            return;
            case 3:
            this.PasswordBox = ((System.Windows.Controls.PasswordBox)(target));
            return;
            case 4:
            this.ConfirmPasswordBox = ((System.Windows.Controls.PasswordBox)(target));
            return;
            case 5:
            
            #line 167 "..\..\..\Pages\RegIn.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.RegisterButton_Click);
            
            #line default
            #line hidden
            return;
            case 6:
            
            #line 174 "..\..\..\Pages\RegIn.xaml"
            ((System.Windows.Controls.Button)(target)).Click += new System.Windows.RoutedEventHandler(this.BackButton_Click);
            
            #line default
            #line hidden
            return;
            case 7:
            
            #line 184 "..\..\..\Pages\RegIn.xaml"
            ((System.Windows.Controls.TextBlock)(target)).MouseLeftButtonDown += new System.Windows.Input.MouseButtonEventHandler(this.LoginText_MouseLeftButtonDown);
            
            #line default
            #line hidden
            return;
            }
            this._contentLoaded = true;
        }
    }
}

﻿using System.Linq;
using System.Windows;
using System.Windows.Controls;
using UP.Services;

namespace UP.Pages
{
    public partial class FavoritesPage : Page
    {
        public FavoritesPage()
        {
            InitializeComponent();
            LoadFavorites();
        }

        private void LoadFavorites()
        {
            FavoritesList.ItemsSource = AppData.Favorites;
        }

        private void BackButton_Click(object sender, RoutedEventArgs e)
        {
            MainWindow.mainWindow.OpenPages(new Receipts());
        }

        private async void OpenRecipe_Click(object sender, RoutedEventArgs e)
        {
            if (sender is Button button && button.DataContext is RecipeDetailsPage.RecipeData recipe)
            {
                var detailsPage = new RecipeDetailsPage(
                    recipe.Title,
                    recipe.Description,
                    recipe.ImageUrl,
                    recipe.Ingredients,
                    recipe.Steps
                );

                MainWindow.mainWindow.OpenPages(detailsPage);
            }
        }

        private async void RemoveRecipe_Click(object sender, RoutedEventArgs e)
        {
            if (sender is Button button && button.DataContext is RecipeDetailsPage.RecipeData recipe)
            {
                if (MessageBox.Show($"Удалить рецепт '{recipe.Title}' из избранного?", "Подтверждение",
                                    MessageBoxButton.YesNo, MessageBoxImage.Question) == MessageBoxResult.Yes)
                {
                    var success = await AppData.RemoveFromFavorites(recipe);
                    if (success)
                    {
                        AppData.Favorites.Remove(recipe);
                        MessageBox.Show("Рецепт удален из избранного", "Успех");
                    }
                    else
                    {
                        MessageBox.Show("Не удалось удалить рецепт", "Ошибка");
                    }
                }
            }
        }

        private async void RefreshFavorites_Click(object sender, RoutedEventArgs e)
        {
            await AppData.LoadFavorites();
            LoadFavorites();
        }
    }
}﻿using System;
using System.Collections.Generic;
using System.Net.Http;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Input;
using UP.Models;
using UP.Services;

namespace UP.Pages
{
    public partial class LogInPage : Page
    {
        private string secretCode = "qweasd";

        public LogInPage()
        {
            InitializeComponent();
            Loaded += (s, e) => UsernameTextBox.Focus();
            UsernameTextBox.KeyDown += TextBox_KeyDown;
            PasswordBox.KeyDown += TextBox_KeyDown;
        }

        private async void LoginButton_Click(object sender, RoutedEventArgs e)
        {
            await AttemptLogin();
        }

        private async void TextBox_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.Key == Key.Enter)
            {
                await AttemptLogin();
            }
        }

        private async Task AttemptLogin()
        {
            string username = UsernameTextBox.Text;
            string password = PasswordBox.Password;

            if (string.IsNullOrWhiteSpace(username))
            {
                ShowMessage("Введите имя пользователя");
                UsernameTextBox.Focus();
                return;
            }

            if (string.IsNullOrWhiteSpace(password))
            {
                ShowMessage("Введите пароль");
                PasswordBox.Focus();
                return;
            }

            LoginButton.IsEnabled = false;
            LoginButton.Content = "Вход...";

            try
            {
                var user = await AppData.ApiService.LoginAsync(username, password);
                AppData.InitializeAfterLogin(user);

                ShowMessage($"Успешный вход! Добро пожаловать, {user.Username}");
                MainWindow.mainWindow.OpenPages(new Receipts());
            }
            catch (HttpRequestException httpEx)
            {
                ShowMessage($"Ошибка сети: {httpEx.Message}\n\nПроверьте:\n1. Запущен ли бекенд\n2. Блокирует ли фаервол\n3. Доступен ли localhost:7197");
            }
            catch (Exception ex)
            {
                ShowMessage($"Ошибка входа: {ex.Message}");
            }
            finally
            {
                LoginButton.IsEnabled = true;
                LoginButton.Content = "Войти";
            }
        }
        private void ShowMessage(string message)
        {
            MessageBox.Show(message, "Вход в систему",
                          MessageBoxButton.OK, MessageBoxImage.Information);
        }

        private void RegisterText_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
        {
            NavigationService?.Navigate(new RegIn());
        }

        private void SecretCodeBox_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.Key == Key.Enter)
            {
                if (SecretCodeBox.Text == secretCode)
                {
                    ShowScaryImage();
                }
                SecretCodeBox.Clear();
            }
        }

        private void ShowScaryImage()
        {
            Window scaryWindow = new Window
            {
                Height = 1080,
                Width = 1920,
                WindowState = WindowState.Maximized,
                WindowStyle = WindowStyle.None,
                Topmost = true,
                Left = 0,
                Top = 0
            };

            Image img = new Image
            {
                Source = new System.Windows.Media.Imaging.BitmapImage(new System.Uri("pack://application:,,,/Images/scary.jpg")),
                Stretch = System.Windows.Media.Stretch.UniformToFill
            };

            scaryWindow.Content = img;
            scaryWindow.Show();
        }
    }
}﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Windows;
using System.Windows.Controls;
using UP.Models;
using UP.Services;

namespace UP.Pages
{
    public partial class RecipeDetailsPage : Page
    {
        public class RecipeData
        {
            public string Title { get; set; }
            public string Description { get; set; }
            public string ImageUrl { get; set; }
            public List<string> Ingredients { get; set; }
            public List<string> Steps { get; set; }
        }

        private RecipeData _currentRecipe;

        public RecipeDetailsPage(string title, string description, string imageUrl, List<string> ingredients, List<string> steps)
        {
            InitializeComponent();

            _currentRecipe = new RecipeData
            {
                Title = title,
                Description = description,
                ImageUrl = imageUrl,
                Ingredients = ingredients,
                Steps = steps
            };

            RecipeTitleText.Text = title;
            RecipeDescriptionText.Text = description;

            if (!string.IsNullOrEmpty(imageUrl))
            {
                RecipeImage.Source = new System.Windows.Media.Imaging.BitmapImage(new Uri(imageUrl));
            }

            IngredientsList.ItemsSource = ingredients;

            var stepObjects = new List<object>();
            int i = 1;
            foreach (var step in steps)
                stepObjects.Add(new { StepNumber = i++, StepText = step });
            StepsList.ItemsSource = stepObjects;
        }

        private void BackButton_Click(object sender, RoutedEventArgs e)
        {
            MainWindow.mainWindow.OpenPages(new Receipts());
        }

        private void StartTimer_Click(object sender, RoutedEventArgs e)
        {
            var timerWindow = new TimerWindow(RecipeTitleText.Text);
            timerWindow.ShowDialog();
        }

        private void AddToShoppingList_Click(object sender, RoutedEventArgs e)
        {
            // Добавляем ингредиенты в локальный список
            foreach (var ingredient in _currentRecipe.Ingredients)
            {
                AppData.ShoppingList.Add(ingredient);
            }

            MessageBox.Show("Ингредиенты добавлены в список покупок.", "Список покупок",
                            MessageBoxButton.OK, MessageBoxImage.Information);
        }

        private async void AddToFavorites_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                var success = await AppData.AddToFavorites(_currentRecipe);
                if (success)
                {
                    // Проверяем, нет ли уже в избранном
                    if (!AppData.Favorites.Any(f => f.Title == _currentRecipe.Title))
                    {
                        AppData.Favorites.Add(_currentRecipe);
                    }

                    MessageBox.Show("Рецепт добавлен в избранное!", "Избранное",
                                    MessageBoxButton.OK, MessageBoxImage.Information);
                }
                else
                {
                    MessageBox.Show("Не удалось добавить в избранное", "Ошибка",
                                    MessageBoxButton.OK, MessageBoxImage.Error);
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Ошибка: {ex.Message}", "Ошибка",
                                MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }
    }
}﻿using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Media;
using UP.Models;

namespace UP.Pages
{
    public partial class Receipts : Page
    {
        public class DailyMenu
        {
            public string Day { get; set; }
            public string Meal { get; set; }
            public string Description { get; set; }
            public int RecipeId { get; set; }
        }

        public class TimerItem
        {
            public string Name { get; set; }
            public string TimeLeft { get; set; }
            public System.Windows.Threading.DispatcherTimer Timer { get; set; }
            public DateTime EndTime { get; set; }
        }

        private ObservableCollection<string> _products;
        private ObservableCollection<DailyMenu> _weeklyMenu;
        private ObservableCollection<TimerItem> _activeTimers;
        private ObservableCollection<string> _shoppingList;

        public Receipts()
        {
            InitializeComponent();
            InitializeData();
        }

        private void InitializeData()
        {
            _products = AppData.Products;
            _weeklyMenu = AppData.WeeklyMenu;
            _shoppingList = AppData.ShoppingList;
            _activeTimers = new ObservableCollection<TimerItem>();

            ProductsListView.ItemsSource = _products;
            WeeklyMenuItemsControl.ItemsSource = _weeklyMenu;
            ActiveTimersItemsControl.ItemsSource = _activeTimers;
            ShoppingListListView.ItemsSource = _shoppingList;

            UpdateNoTimersVisibility();
        }

        private async void AddProduct_Click(object sender, RoutedEventArgs e)
        {
            if (!string.IsNullOrWhiteSpace(NewProductTextBox.Text))
            {
                var product = NewProductTextBox.Text.Trim();
                _products.Add(product);
                NewProductTextBox.Clear();

                await SaveProductToInventory(product);
            }
        }

        private async Task SaveProductToInventory(string productName)
        {
            try
            {
                Console.WriteLine($"Saving product to inventory: {productName}");

                var success = await AppData.ApiService.AddToInventoryByNameAsync(productName, 1, "шт");

                if (success)
                {
                    Console.WriteLine($"Product {productName} added to inventory successfully");
                }
                else
                {
                    Console.WriteLine($"Failed to add {productName} to inventory, adding locally");
                    AppData.Products.Add(productName);
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error saving product to inventory: {ex.Message}");
                AppData.Products.Add(productName);
            }
        }

        private void RemoveProduct_Click(object sender, RoutedEventArgs e)
        {
            if (sender is Button button && button.DataContext is string product)
            {
                _products.Remove(product);
            }
        }

        private async void GenerateMenu_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                if (GenerateMenuButton != null)
                {
                    GenerateMenuButton.IsEnabled = false;
                    GenerateMenuButton.Content = "Генерация...";
                }

                var allergies = GetSelectedAllergies();

                var request = new GenerateMenuRequest
                {
                    Days = 7,
                    TargetCaloriesPerDay = 2000,
                    CuisineTags = new List<string> { "russian", "italian", "mediterranean" },
                    UseInventory = _products.Count > 0,
                    MealTypes = new List<string> { "breakfast", "lunch", "dinner" }
                };

                var success = await AppData.GenerateNewMenu(request);

                if (success)
                {
                    MessageBox.Show("Меню успешно сгенерировано!", "Успех",
                                  MessageBoxButton.OK, MessageBoxImage.Information);
                }
                else
                {
                    MessageBox.Show("Не удалось сгенерировать меню. Попробуйте другие настройки.", "Ошибка",
                                  MessageBoxButton.OK, MessageBoxImage.Error);
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Ошибка генерации меню: {ex.Message}", "Ошибка",
                              MessageBoxButton.OK, MessageBoxImage.Error);
            }
            finally
            {
                if (GenerateMenuButton != null)
                {
                    GenerateMenuButton.IsEnabled = true;
                    GenerateMenuButton.Content = "🎲 Сгенерировать меню на неделю";
                }
            }
        }

        private List<string> GetSelectedAllergies()
        {
            var allergies = new List<string>();

            if (GlutenCheckBox?.IsChecked == true)
                allergies.Add("глютен");
            if (LactoseCheckBox?.IsChecked == true)
                allergies.Add("лактоза");
            if (NutsCheckBox?.IsChecked == true)
                allergies.Add("орехи");
            if (SeafoodCheckBox?.IsChecked == true)
                allergies.Add("морепродукты");

            if (!string.IsNullOrWhiteSpace(OtherAllergiesTextBox?.Text))
            {
                var customAllergies = OtherAllergiesTextBox.Text.Split(',')
                    .Select(t => t.Trim())
                    .Where(t => !string.IsNullOrEmpty(t));
                allergies.AddRange(customAllergies);
            }

            return allergies;
        }

        private async void OpenRecipe_Click(object sender, RoutedEventArgs e)
        {
            if (sender is Button button && button.DataContext is DailyMenu dailyMenu)
            {
                try
                {
                    if (dailyMenu.RecipeId > 0)
                    {
                        var recipe = await AppData.ApiService.GetRecipeAsync(dailyMenu.RecipeId);

                        if (recipe != null)
                        {
                            var detailsPage = new RecipeDetailsPage(
                                recipe.Title,
                                recipe.Description,
                                recipe.ImageUrl,
                                recipe.Ingredients.ConvertAll(i => $"{i.Name} - {i.Quantity} {i.Unit}"),
                                recipe.Instructions
                            );

                            MainWindow.mainWindow.OpenPages(detailsPage);
                            return;
                        }
                    }

                    var recipeByName = AppData.AllRecipes.FirstOrDefault(r =>
                        r.Title.Equals(dailyMenu.Meal, StringComparison.OrdinalIgnoreCase));

                    if (recipeByName != null)
                    {
                        var detailsPage = new RecipeDetailsPage(
                            recipeByName.Title,
                            recipeByName.Description,
                            recipeByName.ImageUrl,
                            recipeByName.Ingredients.ConvertAll(i => $"{i.Name} - {i.Quantity} {i.Unit}"),
                            recipeByName.Instructions
                        );

                        MainWindow.mainWindow.OpenPages(detailsPage);
                    }
                    else
                    {
                        MessageBox.Show("Рецепт не найден", "Ошибка");
                    }
                }
                catch (Exception ex)
                {
                    MessageBox.Show($"Ошибка загрузки рецепта: {ex.Message}");
                }
            }
        }

        private void OpenFavorites_Click(object sender, RoutedEventArgs e)
        {
            MainWindow.mainWindow.OpenPages(new FavoritesPage());
        }

        private void StartTimer_Click(object sender, RoutedEventArgs e)
        {
            if (sender is Button button && button.DataContext is DailyMenu menu)
            {
                var timerWindow = new TimerWindow(menu.Meal);
                if (timerWindow.ShowDialog() == true)
                {
                    var timerItem = new TimerItem
                    {
                        Name = menu.Meal,
                        EndTime = DateTime.Now.AddMinutes(timerWindow.SelectedMinutes),
                        Timer = new System.Windows.Threading.DispatcherTimer()
                    };

                    timerItem.Timer.Interval = TimeSpan.FromSeconds(1);
                    timerItem.Timer.Tick += (s, args) => UpdateTimer(timerItem);
                    timerItem.Timer.Start();

                    _activeTimers.Add(timerItem);
                    UpdateNoTimersVisibility();
                    UpdateTimer(timerItem);
                }
            }
        }

        private void UpdateTimer(TimerItem timerItem)
        {
            var timeLeft = timerItem.EndTime - DateTime.Now;

            if (timeLeft.TotalSeconds <= 0)
            {
                timerItem.Timer.Stop();
                timerItem.TimeLeft = "Время вышло!";
                MessageBox.Show($"Таймер '{timerItem.Name}' завершил работу!", "Таймер",
                              MessageBoxButton.OK, MessageBoxImage.Information);
            }
            else
            {
                timerItem.TimeLeft = $"{timeLeft:mm\\:ss}";
            }

            var index = _activeTimers.IndexOf(timerItem);
            if (index >= 0)
            {
                _activeTimers[index] = timerItem;
            }
        }

        private void StopTimer_Click(object sender, RoutedEventArgs e)
        {
            if (sender is Button button && button.DataContext is TimerItem timerItem)
            {
                timerItem.Timer.Stop();
                _activeTimers.Remove(timerItem);
                UpdateNoTimersVisibility();
            }
        }

        private void UpdateNoTimersVisibility()
        {
            NoTimersText.Visibility = _activeTimers.Count == 0 ? Visibility.Visible : Visibility.Collapsed;
        }

        private void ShoppingItem_Checked(object sender, RoutedEventArgs e)
        {
        }

        private async void ExportShoppingList_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                var saveDialog = new Microsoft.Win32.SaveFileDialog
                {
                    Filter = "Текстовые файлы (*.txt)|*.txt",
                    FileName = "Список_покупок.txt"
                };

                if (saveDialog.ShowDialog() == true)
                {
                    var lines = new List<string> { "Список покупок:", "==================" };
                    foreach (var item in _shoppingList)
                    {
                        lines.Add($"- {item}");
                    }
                    System.IO.File.WriteAllLines(saveDialog.FileName, lines);

                    MessageBox.Show("Список покупок экспортирован!", "Успех",
                                  MessageBoxButton.OK, MessageBoxImage.Information);
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Ошибка при экспорте: {ex.Message}", "Ошибка",
                              MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private void BackButton_Click(object sender, RoutedEventArgs e)
        {
            foreach (var timer in _activeTimers)
            {
                timer.Timer.Stop();
            }

            AppData.Logout();
            MainWindow.mainWindow.OpenPages(new LogInPage());
        }

        private void OtherAllergiesTextBox_TextChanged(object sender, TextChangedEventArgs e)
        {
        }

        private async void RefreshData_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                await AppData.LoadInitialData();
                MessageBox.Show("Данные обновлены", "Успех");
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Ошибка обновления: {ex.Message}", "Ошибка");
            }
        }
    }

    public class TimerWindow : Window
    {
        public int SelectedMinutes { get; private set; } = 10;

        public TimerWindow(string mealName)
        {
            InitializeComponent();
            Title = $"Таймер для: {mealName}";
        }

        private void InitializeComponent()
        {
            Width = 300;
            Height = 200;
            WindowStartupLocation = WindowStartupLocation.CenterOwner;
            ResizeMode = ResizeMode.NoResize;

            var stackPanel = new StackPanel { Margin = new Thickness(20) };

            stackPanel.Children.Add(new TextBlock
            {
                Text = "Установите время таймера (минуты):",
                Foreground = Brushes.White,
                Margin = new Thickness(0, 0, 0, 10)
            });

            var slider = new Slider
            {
                Minimum = 1,
                Maximum = 120,
                Value = SelectedMinutes,
                Margin = new Thickness(0, 0, 0, 10)
            };
            slider.ValueChanged += (s, e) => SelectedMinutes = (int)e.NewValue;
            stackPanel.Children.Add(slider);

            var valueText = new TextBlock
            {
                Text = $"{SelectedMinutes} мин.",
                Foreground = Brushes.White,
                HorizontalAlignment = HorizontalAlignment.Center,
                Margin = new Thickness(0, 0, 0, 20)
            };
            stackPanel.Children.Add(valueText);

            slider.ValueChanged += (s, e) =>
            {
                SelectedMinutes = (int)e.NewValue;
                valueText.Text = $"{SelectedMinutes} мин.";
            };

            var buttonPanel = new StackPanel { Orientation = Orientation.Horizontal, HorizontalAlignment = HorizontalAlignment.Center };

            var okButton = new Button
            {
                Content = "Запустить",
                Background = new SolidColorBrush(Color.FromRgb(76, 175, 80)),
                Foreground = Brushes.White,
                Margin = new Thickness(0, 0, 10, 0)
            };
            okButton.Click += (s, e) => { DialogResult = true; Close(); };
            buttonPanel.Children.Add(okButton);

            var cancelButton = new Button
            {
                Content = "Отмена",
                Background = new SolidColorBrush(Color.FromRgb(244, 67, 54)),
                Foreground = Brushes.White,
            };
            cancelButton.Click += (s, e) => { DialogResult = false; Close(); };
            buttonPanel.Children.Add(cancelButton);

            stackPanel.Children.Add(buttonPanel);

            Content = stackPanel;
            Background = new SolidColorBrush(Color.FromRgb(30, 30, 30));
        }
    }
}﻿// RegIn.xaml.cs
using System;
using System.Collections.Generic;
using System.Text.RegularExpressions;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Input;
using UP.Models;
using UP.Services;

namespace UP.Pages
{
    public partial class RegIn : Page
    {
        public RegIn()
        {
            InitializeComponent();
            Loaded += (s, e) => UsernameTextBox.Focus();

            // Обработка Enter для быстрой навигации
            UsernameTextBox.KeyDown += TextBox_KeyDown;
            EmailTextBox.KeyDown += TextBox_KeyDown;
            PasswordBox.KeyDown += TextBox_KeyDown;
            ConfirmPasswordBox.KeyDown += TextBox_KeyDown;
        }

        private void TextBox_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.Key == Key.Enter)
            {
                if (sender == UsernameTextBox)
                    EmailTextBox.Focus();
                else if (sender == EmailTextBox)
                    PasswordBox.Focus();
                else if (sender == PasswordBox)
                    ConfirmPasswordBox.Focus();
                else if (sender == ConfirmPasswordBox)
                    RegisterButton_Click(null, null);
            }
        }

        private async void RegisterButton_Click(object sender, RoutedEventArgs e)
        {
            if (!ValidateForm())
                return;

            try
            {
                // Регистрация пользователя через API
                var user = await AppData.ApiService.RegisterAsync(
                    UsernameTextBox.Text.Trim(),
                    EmailTextBox.Text.Trim(),
                    PasswordBox.Password,
                    new List<string>()); // Аллергии можно добавить позже

                AppData.InitializeAfterLogin(user);

                // Возврат на страницу входа
                NavigationService?.Navigate(new LogInPage());

                MessageBox.Show("Регистрация успешна! Теперь вы можете войти в систему.",
                              "Успешная регистрация",
                              MessageBoxButton.OK, MessageBoxImage.Information);
            }
            catch (Exception ex)
            {
                ShowError($"Ошибка регистрации: {ex.Message}");
            }
        }

        private bool ValidateForm()
        {
            // Проверка имени пользователя
            if (string.IsNullOrWhiteSpace(UsernameTextBox.Text))
            {
                ShowError("Введите имя пользователя");
                UsernameTextBox.Focus();
                return false;
            }

            if (UsernameTextBox.Text.Length < 3)
            {
                ShowError("Имя пользователя должно содержать минимум 3 символа");
                UsernameTextBox.Focus();
                return false;
            }

            // Проверка email
            if (string.IsNullOrWhiteSpace(EmailTextBox.Text))
            {
                ShowError("Введите email");
                EmailTextBox.Focus();
                return false;
            }

            if (!IsValidEmail(EmailTextBox.Text))
            {
                ShowError("Введите корректный email адрес");
                EmailTextBox.Focus();
                return false;
            }

            // Проверка пароля
            if (string.IsNullOrWhiteSpace(PasswordBox.Password))
            {
                ShowError("Введите пароль");
                PasswordBox.Focus();
                return false;
            }

            if (PasswordBox.Password.Length < 6)
            {
                ShowError("Пароль должен содержать минимум 6 символов");
                PasswordBox.Focus();
                return false;
            }

            // Проверка подтверждения пароля
            if (PasswordBox.Password != ConfirmPasswordBox.Password)
            {
                ShowError("Пароли не совпадают");
                ConfirmPasswordBox.Focus();
                return false;
            }

            return true;
        }

        private bool IsValidEmail(string email)
        {
            try
            {
                var regex = new Regex(@"^[^@\s]+@[^@\s]+\.[^@\s]+$");
                return regex.IsMatch(email);
            }
            catch
            {
                return false;
            }
        }

        private void ShowError(string message)
        {
            MessageBox.Show(message, "Ошибка валидации",
                          MessageBoxButton.OK, MessageBoxImage.Warning);
        }

        private void BackButton_Click(object sender, RoutedEventArgs e)
        {
            NavigationService?.Navigate(new LogInPage());
        }

        private void LoginText_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
        {
            NavigationService?.Navigate(new LogInPage());
        }
    }
}﻿using System.Reflection;
using System.Resources;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;
using System.Windows;

// Общие сведения об этой сборке предоставляются следующим набором
// набор атрибутов. Измените значения этих атрибутов, чтобы изменить сведения,
// связанные со сборкой.
[assembly: AssemblyTitle("UP")]
[assembly: AssemblyDescription("")]
[assembly: AssemblyConfiguration("")]
[assembly: AssemblyCompany("")]
[assembly: AssemblyProduct("UP")]
[assembly: AssemblyCopyright("Copyright ©  2025")]
[assembly: AssemblyTrademark("")]
[assembly: AssemblyCulture("")]

// Установка значения False для параметра ComVisible делает типы в этой сборке невидимыми
// для компонентов COM. Если необходимо обратиться к типу в этой сборке через
// из модели COM, установите атрибут ComVisible для этого типа в значение true.
[assembly: ComVisible(false)]

//Чтобы начать создание локализуемых приложений, задайте
//<UICulture>CultureYouAreCodingWith</UICulture> в файле .csproj
//в <PropertyGroup>. Например, при использовании английского (США)
//в своих исходных файлах установите <UICulture> в en-US.  Затем отмените преобразование в комментарий
//атрибута NeutralResourceLanguage ниже.  Обновите "en-US" в
//строка внизу для обеспечения соответствия настройки UICulture в файле проекта.

//[assembly: NeutralResourcesLanguage("en-US", UltimateResourceFallbackLocation.Satellite)]


[assembly: ThemeInfo(
    ResourceDictionaryLocation.None, //где расположены словари ресурсов по конкретным тематикам
                                     //(используется, если ресурс не найден на странице,
                                     // или в словарях ресурсов приложения)
    ResourceDictionaryLocation.SourceAssembly //где расположен словарь универсальных ресурсов
                                              //(используется, если ресурс не найден на странице,
                                              // в приложении или в каких-либо словарях ресурсов для конкретной темы)
)]


// Сведения о версии для сборки включают четыре следующих значения:
//
//      Основной номер версии
//      Дополнительный номер версии
//      Номер сборки
//      Номер редакции
//
[assembly: AssemblyVersion("1.0.0.0")]
[assembly: AssemblyFileVersion("1.0.0.0")]
﻿//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код был создан программным средством.
//     Версия среды выполнения: 4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильному поведению и будут утрачены, если
//     код создан повторно.
// </auto-generated>
//------------------------------------------------------------------------------

namespace UP.Properties
{


    /// <summary>
    ///   Класс ресурсов со строгим типом для поиска локализованных строк и пр.
    /// </summary>
    // Этот класс был автоматически создан при помощи StronglyTypedResourceBuilder
    // класс с помощью таких средств, как ResGen или Visual Studio.
    // Для добавления или удаления члена измените файл .ResX, а затем перезапустите ResGen
    // с параметром /str или заново постройте свой VS-проект.
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "4.0.0.0")]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    internal class Resources
    {

        private static global::System.Resources.ResourceManager resourceMan;

        private static global::System.Globalization.CultureInfo resourceCulture;

        [global::System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode")]
        internal Resources()
        {
        }

        /// <summary>
        ///   Возврат кэшированного экземпляра ResourceManager, используемого этим классом.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        internal static global::System.Resources.ResourceManager ResourceManager
        {
            get
            {
                if ((resourceMan == null))
                {
                    global::System.Resources.ResourceManager temp = new global::System.Resources.ResourceManager("UP.Properties.Resources", typeof(Resources).Assembly);
                    resourceMan = temp;
                }
                return resourceMan;
            }
        }

        /// <summary>
        ///   Переопределяет свойство CurrentUICulture текущего потока для всех
        ///   подстановки ресурсов с помощью этого класса ресурсов со строгим типом.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        internal static global::System.Globalization.CultureInfo Culture
        {
            get
            {
                return resourceCulture;
            }
            set
            {
                resourceCulture = value;
            }
        }
    }
}
﻿//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

namespace UP.Properties
{


    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.Editors.SettingsDesigner.SettingsSingleFileGenerator", "11.0.0.0")]
    internal sealed partial class Settings : global::System.Configuration.ApplicationSettingsBase
    {

        private static Settings defaultInstance = ((Settings)(global::System.Configuration.ApplicationSettingsBase.Synchronized(new Settings())));

        public static Settings Default
        {
            get
            {
                return defaultInstance;
            }
        }
    }
}
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace UP.Services
{
    internal class ApiClient
    {
    }
}
using System;
using System.Collections.Generic;
using System.Linq;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Text;
using System.Threading.Tasks;
using Newtonsoft.Json;
using UP.Models;

namespace UP.Services
{
    public class ApiService
    {
        private readonly HttpClient _httpClient;
        private string _baseUrl;
        private string _token;

        public ApiService(string baseUrl = "https://localhost:7197/api/")
        {
            _baseUrl = baseUrl;

            var handler = new HttpClientHandler
            {
                ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true
            };

            _httpClient = new HttpClient(handler);
            _httpClient.Timeout = TimeSpan.FromSeconds(30);
            _httpClient.DefaultRequestHeaders.Accept.Add(
                new MediaTypeWithQualityHeaderValue("application/json"));
            _httpClient.DefaultRequestHeaders.AcceptCharset.Add(new StringWithQualityHeaderValue("utf-8"));
        }

        public void SetToken(string token)
        {
            _token = token;
            // Не устанавливаем заголовок Authorization, если API не использует Bearer
        }

        public void ClearToken()
        {
            _token = null;
        }

        public async Task<UserData> LoginAsync(string username, string password)
        {
            try
            {
                Console.WriteLine($"Попытка входа для пользователя: {username}");

                var formData = new Dictionary<string, string>
                {
                    { "username", username },
                    { "password", password }
                };

                var content = new FormUrlEncodedContent(formData);

                Console.WriteLine($"Отправка запроса на: {_baseUrl}Auth/login");

                var response = await _httpClient.PostAsync($"{_baseUrl}Auth/login", content);

                Console.WriteLine($"Статус ответа: {response.StatusCode}");

                var responseString = await response.Content.ReadAsStringAsync();
                Console.WriteLine($"Содержимое ответа: {responseString}");

                if (!response.IsSuccessStatusCode)
                {
                    var errorContent = await response.Content.ReadAsStringAsync();
                    Console.WriteLine($"Ошибка HTTP: {response.StatusCode}, Контент: {errorContent}");
                    throw new HttpRequestException($"Ошибка входа: {response.StatusCode}. {errorContent}");
                }

                // Парсим ответ
                var responseObject = JsonConvert.DeserializeObject<dynamic>(responseString);
                Console.WriteLine($"Распарсенный объект: {responseObject}");

                if (responseObject != null)
                {
                    var userData = new UserData();

                    // Формат ответа из вашего примера
                    userData.Id = responseObject.id ?? 0;
                    userData.Username = responseObject.username ?? username;
                    userData.Email = responseObject.email ?? "";
                    userData.FullName = responseObject.fullName ?? username;

                    // Не используем токен, так как API его не возвращает
                    Console.WriteLine($"Вход успешен для пользователя: {userData.Username}, ID: {userData.Id}");

                    return userData;
                }
                else
                {
                    var errorMessage = responseObject?.message?.ToString() ?? "Ошибка входа";
                    Console.WriteLine($"Ошибка входа: {errorMessage}");
                    throw new Exception(errorMessage);
                }
            }
            catch (JsonException jsonEx)
            {
                Console.WriteLine($"Ошибка парсинга JSON: {jsonEx.Message}");
                throw new Exception($"Ошибка обработки ответа от сервера: {jsonEx.Message}");
            }
            catch (HttpRequestException httpEx)
            {
                Console.WriteLine($"Ошибка сети: {httpEx.Message}");
                throw new HttpRequestException($"Ошибка сети: {httpEx.Message}. Проверьте, запущен ли сервер API.", httpEx);
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Общая ошибка входа: {ex.Message}");
                Console.WriteLine($"StackTrace: {ex.StackTrace}");
                throw new Exception($"Ошибка входа: {ex.Message}");
            }
        }

        public async Task<UserData> RegisterAsync(string username, string email, string password, List<string> allergies)
        {
            try
            {
                Console.WriteLine($"Регистрация пользователя: {username}, email: {email}");

                var formData = new Dictionary<string, string>
                {
                    { "username", username },
                    { "email", email },
                    { "password", password },
                    { "fullName", username }
                };

                var content = new FormUrlEncodedContent(formData);
                var response = await _httpClient.PostAsync($"{_baseUrl}Auth/register", content);

                var responseString = await response.Content.ReadAsStringAsync();
                Console.WriteLine($"Ответ регистрации: {responseString}");

                if (!response.IsSuccessStatusCode)
                {
                    var errorContent = await response.Content.ReadAsStringAsync();
                    throw new HttpRequestException($"Ошибка регистрации: {response.StatusCode}. {errorContent}");
                }

                var responseObject = JsonConvert.DeserializeObject<dynamic>(responseString);

                if (responseObject != null && responseObject.success == true)
                {
                    return new UserData
                    {
                        Id = responseObject.data?.Id ?? responseObject.id ?? 0,
                        Username = responseObject.data?.Username ?? responseObject.username ?? username,
                        Email = responseObject.data?.Email ?? responseObject.email ?? email,
                        FullName = responseObject.data?.FullName ?? responseObject.fullName ?? username
                    };
                }
                else
                {
                    throw new Exception(responseObject?.message?.ToString() ?? "Ошибка регистрации");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Ошибка регистрации: {ex.Message}");
                throw new Exception($"Ошибка регистрации: {ex.Message}");
            }
        }

        // Остальные методы (GetRecipesAsync, GetRecipeAsync и т.д.) оставляем без изменений
        // Только убираем из них любые упоминания Authorization header

        public async Task<List<RecipeDto>> GetRecipesAsync()
        {
            try
            {
                var response = await _httpClient.GetAsync($"{_baseUrl}Recipes");
                var responseString = await response.Content.ReadAsStringAsync();
                var responseObject = JsonConvert.DeserializeObject<dynamic>(responseString);

                if (responseObject != null && responseObject.success == true)
                {
                    return JsonConvert.DeserializeObject<List<RecipeDto>>(responseObject.data.ToString());
                }

                return new List<RecipeDto>();
            }
            catch (Exception ex)
            {
                Console.WriteLine($"GetRecipesAsync error: {ex.Message}");
                return new List<RecipeDto>();
            }
        }

        public async Task<RecipeDto> GetRecipeAsync(int id)
        {
            try
            {
                var response = await _httpClient.GetAsync($"{_baseUrl}Recipes/{id}");
                var responseString = await response.Content.ReadAsStringAsync();
                var responseObject = JsonConvert.DeserializeObject<dynamic>(responseString);

                if (responseObject != null && responseObject.success == true)
                {
                    return JsonConvert.DeserializeObject<RecipeDto>(responseObject.data.ToString());
                }

                return null;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"GetRecipeAsync error: {ex.Message}");
                return null;
            }
        }

        public async Task<List<RecipeDto>> GetFavoritesAsync()
        {
            try
            {
                var userId = AppData.CurrentUser?.Id ?? 0;
                var response = await _httpClient.GetAsync($"{_baseUrl}Recipes/favorites/{userId}");
                var responseString = await response.Content.ReadAsStringAsync();
                var responseObject = JsonConvert.DeserializeObject<dynamic>(responseString);

                if (responseObject != null && responseObject.success == true)
                {
                    return JsonConvert.DeserializeObject<List<RecipeDto>>(responseObject.data.ToString());
                }

                return new List<RecipeDto>();
            }
            catch (Exception ex)
            {
                Console.WriteLine($"GetFavoritesAsync error: {ex.Message}");
                return new List<RecipeDto>();
            }
        }

        public async Task<bool> ToggleFavoriteAsync(int recipeId)
        {
            try
            {
                var userId = AppData.CurrentUser?.Id ?? 0;
                var formData = new Dictionary<string, string>();
                var content = new FormUrlEncodedContent(formData);
                var response = await _httpClient.PostAsync($"{_baseUrl}Recipes/{recipeId}/favorite/{userId}", content);

                var responseString = await response.Content.ReadAsStringAsync();
                var responseObject = JsonConvert.DeserializeObject<dynamic>(responseString);

                return responseObject != null && responseObject.success == true;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"ToggleFavoriteAsync error: {ex.Message}");
                return false;
            }
        }

        public async Task<MenuDto> GenerateMenuAsync(GenerateMenuRequest request)
        {
            try
            {
                var userId = AppData.CurrentUser?.Id ?? 0;

                // Создаем multipart form-data вместо JSON
                var formData = new MultipartFormDataContent();
                formData.Add(new StringContent(request.Days.ToString()), "days");

                if (request.TargetCaloriesPerDay.HasValue)
                {
                    formData.Add(new StringContent(request.TargetCaloriesPerDay.Value.ToString()), "targetCaloriesPerDay");
                }

                // Добавляем теги кухни
                if (request.CuisineTags != null && request.CuisineTags.Count > 0)
                {
                    foreach (var tag in request.CuisineTags)
                    {
                        formData.Add(new StringContent(tag), "cuisineTags");
                    }
                }

                if (request.MealTypes != null && request.MealTypes.Count > 0)
                {
                    foreach (var mealType in request.MealTypes)
                    {
                        formData.Add(new StringContent(mealType), "mealTypes");
                    }
                }

                formData.Add(new StringContent(request.UseInventory.ToString().ToLower()), "useInventory");

                Console.WriteLine($"Sending menu generation request to: {_baseUrl}Menu/generate/{userId}");
                Console.WriteLine($"Form data count: {formData.Count()} items");

                var response = await _httpClient.PostAsync($"{_baseUrl}Menu/generate/{userId}", formData);

                var responseString = await response.Content.ReadAsStringAsync();
                Console.WriteLine($"Menu generation response status: {response.StatusCode}");
                Console.WriteLine($"Menu generation response content: {responseString}");

                if (!response.IsSuccessStatusCode)
                {
                    Console.WriteLine($"Menu generation failed: {response.StatusCode} - {responseString}");
                    return null;
                }

                var responseObject = JsonConvert.DeserializeObject<dynamic>(responseString);

                if (responseObject != null && responseObject.success == true)
                {
                    return JsonConvert.DeserializeObject<MenuDto>(responseObject.data.ToString());
                }

                Console.WriteLine($"Menu generation response parsing failed: {responseString}");
                return null;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"GenerateMenuAsync error: {ex.Message}");
                Console.WriteLine($"Stack trace: {ex.StackTrace}");
                return null;
            }
        }

        public async Task<MenuDto> GetCurrentMenuAsync()
        {
            try
            {
                var userId = AppData.CurrentUser?.Id ?? 0;
                var response = await _httpClient.GetAsync($"{_baseUrl}Menu/current/{userId}");
                var responseString = await response.Content.ReadAsStringAsync();
                var responseObject = JsonConvert.DeserializeObject<dynamic>(responseString);

                if (responseObject != null && responseObject.success == true)
                {
                    return JsonConvert.DeserializeObject<MenuDto>(responseObject.data.ToString());
                }

                return null;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"GetCurrentMenuAsync error: {ex.Message}");
                return null;
            }
        }

        public async Task<ShoppingListDto> GetCurrentShoppingListAsync()
        {
            try
            {
                var userId = AppData.CurrentUser?.Id ?? 0;
                var response = await _httpClient.GetAsync($"{_baseUrl}ShoppingList/current/{userId}");
                var responseString = await response.Content.ReadAsStringAsync();
                var responseObject = JsonConvert.DeserializeObject<dynamic>(responseString);

                if (responseObject != null && responseObject.success == true)
                {
                    return JsonConvert.DeserializeObject<ShoppingListDto>(responseObject.data.ToString());
                }

                return null;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"GetCurrentShoppingListAsync error: {ex.Message}");
                return null;
            }
        }

        public async Task<bool> GenerateShoppingListAsync(int menuId)
        {
            try
            {
                var userId = AppData.CurrentUser?.Id ?? 0;
                var formData = new MultipartFormDataContent();
                var response = await _httpClient.PostAsync($"{_baseUrl}ShoppingList/generate-from-menu/{menuId}/{userId}", formData);

                var responseString = await response.Content.ReadAsStringAsync();
                Console.WriteLine($"GenerateShoppingListAsync response: {responseString}");

                var responseObject = JsonConvert.DeserializeObject<dynamic>(responseString);
                return responseObject != null && responseObject.success == true;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"GenerateShoppingListAsync error: {ex.Message}");
                return false;
            }
        }

        public async Task<List<IngredientDto>> GetIngredientsAsync()
        {
            try
            {
                var response = await _httpClient.GetAsync($"{_baseUrl}Recipes/ingredients");
                var responseString = await response.Content.ReadAsStringAsync();
                var responseObject = JsonConvert.DeserializeObject<dynamic>(responseString);

                if (responseObject != null && responseObject.success == true)
                {
                    return JsonConvert.DeserializeObject<List<IngredientDto>>(responseObject.data.ToString());
                }

                return new List<IngredientDto>();
            }
            catch (Exception ex)
            {
                Console.WriteLine($"GetIngredientsAsync error: {ex.Message}");
                return new List<IngredientDto>();
            }
        }

        public async Task<bool> AddToInventoryAsync(int ingredientId, decimal quantity, string unit)
        {
            try
            {
                var userId = AppData.CurrentUser?.Id ?? 0;
                if (userId == 0)
                {
                    Console.WriteLine("User not logged in, cannot add to inventory");
                    return false;
                }

                var ingredients = await GetIngredientsAsync();
                var ingredient = ingredients.FirstOrDefault(i => i.Id == ingredientId);

                if (ingredient == null)
                {
                    Console.WriteLine($"Ingredient with ID {ingredientId} not found");
                    return false;
                }

                var formData = new Dictionary<string, string>
                {
                    { "productName", ingredient.Name },
                    { "quantity", quantity.ToString() },
                    { "unit", unit }
                };

                var content = new FormUrlEncodedContent(formData);
                var response = await _httpClient.PostAsync($"{_baseUrl}Inventory/add/{userId}", content);

                var responseString = await response.Content.ReadAsStringAsync();
                Console.WriteLine($"AddToInventory response: {responseString}");

                if (!response.IsSuccessStatusCode)
                {
                    Console.WriteLine($"AddToInventory failed: {response.StatusCode}");
                    return false;
                }

                try
                {
                    var responseObject = JsonConvert.DeserializeObject<dynamic>(responseString);
                    return responseObject != null && responseObject.success == true;
                }
                catch (JsonException)
                {
                    return response.IsSuccessStatusCode;
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"AddToInventoryAsync error: {ex.Message}");
                return false;
            }
        }

        public async Task<bool> AddToInventoryByNameAsync(string productName, decimal quantity = 1, string unit = "шт")
        {
            try
            {
                var userId = AppData.CurrentUser?.Id ?? 0;
                if (userId == 0)
                {
                    Console.WriteLine("User not logged in, cannot add to inventory");
                    return false;
                }

                var formData = new Dictionary<string, string>
                {
                    { "productName", productName },
                    { "quantity", quantity.ToString() },
                    { "unit", unit }
                };

                var content = new FormUrlEncodedContent(formData);
                var response = await _httpClient.PostAsync($"{_baseUrl}Inventory/add/{userId}", content);

                var responseString = await response.Content.ReadAsStringAsync();
                Console.WriteLine($"AddToInventoryByName response: {responseString}");

                if (!response.IsSuccessStatusCode)
                {
                    Console.WriteLine($"AddToInventoryByName failed: {response.StatusCode}");
                    return false;
                }

                try
                {
                    var responseObject = JsonConvert.DeserializeObject<dynamic>(responseString);
                    return responseObject != null && responseObject.success == true;
                }
                catch (JsonException)
                {
                    return response.IsSuccessStatusCode;
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"AddToInventoryByNameAsync error: {ex.Message}");
                return false;
            }
        }
    }
}﻿//using System;
//using System.Collections.Generic;
//using MySql.Data.MySqlClient;
//using Newtonsoft.Json;

//namespace UP.Services
//{
//    public class DatabaseServiceMySQL
//    {
//        private readonly string _connectionString;

//        public DatabaseServiceMySQL(string server = "localhost", string database = "recipes_db", string user = "root", string password = "root")
//        {
//            _connectionString = $"Server={server};Database={database};Uid={user};Pwd={password};Charset=utf8mb4;";
//            InitializeDatabase();
//        }

//        private void InitializeDatabase()
//        {
//            var conn = new MySqlConnection(_connectionString);
//            conn.Open();

//            var cmd = conn.CreateCommand();
//            cmd.CommandText = @"
//                CREATE TABLE IF NOT EXISTS recipes (
//                    id VARCHAR(36) PRIMARY KEY,
//                    title VARCHAR(255) NOT NULL,
//                    ingredients_json TEXT,
//                    steps_json TEXT,
//                    tags_json TEXT,
//                    calories INT DEFAULT 0,
//                    photo_path VARCHAR(255)
//                );

//                CREATE TABLE IF NOT EXISTS ingredients (
//                    id VARCHAR(36) PRIMARY KEY,
//                    name VARCHAR(255) NOT NULL,
//                    category VARCHAR(100),
//                    allergens_json TEXT
//                );

//                CREATE TABLE IF NOT EXISTS menus (
//                    id VARCHAR(36) PRIMARY KEY,
//                    user_id VARCHAR(36),
//                    created_at DATETIME,
//                    menu_json TEXT
//                );

//                CREATE TABLE IF NOT EXISTS favorites (
//                    recipe_id VARCHAR(36) PRIMARY KEY,
//                    added_at DATETIME
//                );
//            ";
//            cmd.ExecuteNonQuery();
//        }

//        private MySqlConnection GetConnection()
//        {
//            var conn = new MySqlConnection(_connectionString);
//            conn.Open();
//            return conn;
//        }

//        // Добавление или обновление рецепта
//        public void InsertOrUpdateRecipe(string id, string title, string ingredientsJson, string stepsJson, string tagsJson, int calories = 0, string photoPath = null)
//        {
//            var conn = GetConnection();
//            var cmd = conn.CreateCommand();
//            cmd.CommandText = @"
//                INSERT INTO recipes (id, title, ingredients_json, steps_json, tags_json, calories, photo_path)
//                VALUES (@id, @title, @ingredients_json, @steps_json, @tags_json, @calories, @photo_path)
//                ON DUPLICATE KEY UPDATE
//                    title = VALUES(title),
//                    ingredients_json = VALUES(ingredients_json),
//                    steps_json = VALUES(steps_json),
//                    tags_json = VALUES(tags_json),
//                    calories = VALUES(calories),
//                    photo_path = VALUES(photo_path);
//            ";
//            cmd.Parameters.AddWithValue("@id", id);
//            cmd.Parameters.AddWithValue("@title", title);
//            cmd.Parameters.AddWithValue("@ingredients_json", ingredientsJson ?? "");
//            cmd.Parameters.AddWithValue("@steps_json", stepsJson ?? "");
//            cmd.Parameters.AddWithValue("@tags_json", tagsJson ?? "");
//            cmd.Parameters.AddWithValue("@calories", calories);
//            cmd.Parameters.AddWithValue("@photo_path", photoPath ?? "");
//            cmd.ExecuteNonQuery();
//        }

//        public IEnumerable<(string id, string title, string ingredientsJson, string stepsJson, string tagsJson, int calories, string photo)> GetAllRecipes()
//        {
//            var conn = GetConnection();
//            var cmd = conn.CreateCommand();
//            cmd.CommandText = "SELECT id, title, ingredients_json, steps_json, tags_json, calories, photo_path FROM recipes ORDER BY title;";
//            var reader = cmd.ExecuteReader();

//            while (reader.Read())
//            {
//                yield return (
//                    reader.GetString("id"),
//                    reader.GetString("title"),
//                    reader.IsDBNull("ingredients_json") ? "" : reader.GetString("ingredients_json"),
//                    reader.IsDBNull("steps_json") ? "" : reader.GetString("steps_json"),
//                    reader.IsDBNull("tags_json") ? "" : reader.GetString("tags_json"),
//                    reader.IsDBNull("calories") ? 0 : reader.GetInt32("calories"),
//                    reader.IsDBNull("photo_path") ? "" : reader.GetString("photo_path")
//                );
//            }
//        }

//        public void SaveMenu(string id, string userId, string menuJson)
//        {
//            var conn = GetConnection();
//            var cmd = conn.CreateCommand();
//            cmd.CommandText = @"
//                INSERT INTO menus (id, user_id, created_at, menu_json)
//                VALUES (@id, @user_id, @created_at, @menu_json)
//                ON DUPLICATE KEY UPDATE
//                    menu_json = VALUES(menu_json),
//                    created_at = VALUES(created_at);
//            ";
//            cmd.Parameters.AddWithValue("@id", id);
//            cmd.Parameters.AddWithValue("@user_id", userId ?? "");
//            cmd.Parameters.AddWithValue("@created_at", DateTime.UtcNow);
//            cmd.Parameters.AddWithValue("@menu_json", menuJson ?? "");
//            cmd.ExecuteNonQuery();
//        }

//        public void AddFavorite(string recipeId)
//        {
//            var conn = GetConnection();
//            var cmd = conn.CreateCommand();
//            cmd.CommandText = "INSERT INTO favorites (recipe_id, added_at) VALUES (@id, @added_at) ON DUPLICATE KEY UPDATE added_at = VALUES(added_at);";
//            cmd.Parameters.AddWithValue("@id", recipeId);
//            cmd.Parameters.AddWithValue("@added_at", DateTime.UtcNow);
//            cmd.ExecuteNonQuery();
//        }

//        public void RemoveFavorite(string recipeId)
//        {
//            var conn = GetConnection();
//            var cmd = conn.CreateCommand();
//            cmd.CommandText = "DELETE FROM favorites WHERE recipe_id = @id;";
//            cmd.Parameters.AddWithValue("@id", recipeId);
//            cmd.ExecuteNonQuery();
//        }

//        public bool IsFavorite(string recipeId)
//        {
//            var conn = GetConnection();
//            var cmd = conn.CreateCommand();
//            cmd.CommandText = "SELECT 1 FROM favorites WHERE recipe_id = @id LIMIT 1;";
//            cmd.Parameters.AddWithValue("@id", recipeId);
//                var reader = cmd.ExecuteReader();
//            return reader.Read();
//        }
//    }
//}
using Microsoft.EntityFrameworkCore;
using Microsoft.OpenApi.Models;
using YP_API.Data;
using YP_API.Interfaces;
using YP_API.Models;
using YP_API.Repositories;
using YP_API.Services;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowAll", policy =>
    {
        policy.AllowAnyOrigin()
              .AllowAnyMethod()
              .AllowAnyHeader();
    });

    options.AddPolicy("AllowSpecificOrigins", policy =>
    {
        policy.WithOrigins("http://localhost:3000", "http://localhost:4200")
              .AllowAnyMethod()
              .AllowAnyHeader()
              .AllowCredentials();
    });
});

builder.Services.AddLogging(logging =>
{
    logging.AddConsole();
    logging.AddDebug();
    logging.SetMinimumLevel(LogLevel.Debug);
});

builder.Logging.ClearProviders();
builder.Logging.AddConsole();
builder.Logging.AddDebug();

builder.Services.AddControllers();
builder.Services.AddEndpointsApiExplorer();

builder.Services.AddSwaggerGen(c =>
{
    c.SwaggerDoc("v1", new OpenApiInfo
    {
        Title = "Recipe Planner API",
        Version = "v1",
        Description = "API for managing recipes, menus and shopping lists"
    });

    c.CustomSchemaIds(x => x.FullName);
});

var connectionString = builder.Configuration.GetConnectionString("DefaultConnection")
    ?? "Server=127.0.0.1;Port=3306;Database=recipe_planner;Uid=root;Pwd=;";

builder.Services.AddDbContext<RecipePlannerContext>(options =>
{
    options.UseMySql(connectionString, ServerVersion.AutoDetect(connectionString));
    options.EnableSensitiveDataLogging();
    options.EnableDetailedErrors();
});
builder.Services.AddScoped<IRecipeRepository, RecipeRepository>();
builder.Services.AddScoped<IIngredientRepository, IngredientRepository>();
builder.Services.AddScoped<IMenuRepository, MenuRepository>();
builder.Services.AddScoped<IUserRepository, UserRepository>();
builder.Services.AddScoped<IShoppingListRepository, ShoppingListRepository>();

builder.Services.AddScoped<IRepository<ShoppingList>, Repository<ShoppingList>>();
builder.Services.AddScoped<IRepository<ShoppingListItem>, Repository<ShoppingListItem>>();

builder.Services.AddScoped<IAuthService, AuthService>();
builder.Services.AddScoped<IMenuService, MenuService>();
builder.Services.AddScoped<IShoppingListService, ShoppingListService>();

builder.Services.AddScoped<IRepository<UserInventory>, Repository<UserInventory>>();

var app = builder.Build();

app.UseCors("AllowAll");

if (app.Environment.IsDevelopment())
{
    app.UseDeveloperExceptionPage();

    app.UseSwagger();
    app.UseSwaggerUI(c =>
    {
        c.SwaggerEndpoint("/swagger/v1/swagger.json", "Recipe Planner API v1");
        c.RoutePrefix = string.Empty;
        c.DocumentTitle = "Recipe Planner API Documentation";
    });
}
else
{
    app.UseExceptionHandler("/error");
    app.UseHsts();
}

app.Use(async (context, next) =>
{
    var logger = context.RequestServices.GetRequiredService<ILogger<Program>>();
    logger.LogInformation($"Request: {context.Request.Method} {context.Request.Path}");
    await next();
});

app.Use(async (context, next) =>
{
    try
    {
        await next();
    }
    catch (Exception ex)
    {
        var logger = context.RequestServices.GetRequiredService<ILogger<Program>>();
        logger.LogError(ex, "Unhandled exception: {Message}", ex.Message);

        logger.LogError("Stack trace: {StackTrace}", ex.StackTrace);

        context.Response.StatusCode = 500;
        await context.Response.WriteAsJsonAsync(new
        {
            error = "Internal server error",
            message = ex.Message,
            details = ex.StackTrace
        });
    }
});

app.MapControllers();

try
{
    using var scope = app.Services.CreateScope();
    var context = scope.ServiceProvider.GetRequiredService<RecipePlannerContext>();

    Console.WriteLine("Testing database connection...");
    var canConnect = await context.Database.CanConnectAsync();
    Console.WriteLine($"Database connected: {canConnect}");

    if (canConnect)
    {
        var userCount = await context.Users.CountAsync();
        Console.WriteLine($"Users in database: {userCount}");

        var recipeCount = await context.Recipes.CountAsync();
        Console.WriteLine($"Recipes in database: {recipeCount}");
    }
}
catch (Exception ex)
{
    Console.WriteLine($"Database check failed: {ex.Message}");
}

Console.WriteLine("Application started successfully");
Console.WriteLine($"Swagger available at: {app.Urls.FirstOrDefault()}");

app.Run();using Microsoft.EntityFrameworkCore.Metadata.Builders;
using Microsoft.EntityFrameworkCore;
using YP_API.Models;

namespace YP_API.Configurations
{
    public class UserConfiguration : IEntityTypeConfiguration<User>
    {
        public void Configure(EntityTypeBuilder<User> builder)
        {
            builder.HasKey(u => u.Id);

            builder.Property(u => u.Username)
                .IsRequired()
                .HasMaxLength(50);

            builder.Property(u => u.Email)
                .IsRequired()
                .HasMaxLength(100);

            builder.Property(u => u.Password)
                .IsRequired();

            builder.Property(u => u.Password)
                .IsRequired();

            builder.HasIndex(u => u.Username)
                .IsUnique();

            builder.HasIndex(u => u.Email)
                .IsUnique();
        }
    }
}

using Microsoft.AspNetCore.Mvc;
using System.ComponentModel.DataAnnotations;
using YP_API.Models;
using YP_API.Services;

namespace YP_API.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class AuthController : ControllerBase
    {
        private readonly IAuthService _authService;

        public AuthController(IAuthService authService)
        {
            _authService = authService;
        }

        [HttpPost("register")]
        public async Task<ActionResult> Register(
            [FromForm]
            [Required(ErrorMessage = "  ")]
            [StringLength(50, MinimumLength = 3, ErrorMessage = "     3  50 ")]
            [Display(Name = " ")]
            string username,

            [FromForm]
            [Required(ErrorMessage = "Email ")]
            [EmailAddress(ErrorMessage = "  email")]
            [Display(Name = "Email ")]
            string email,

            [FromForm]
            [Required(ErrorMessage = "  ")]
            [StringLength(100, ErrorMessage = "     100 ")]
            [Display(Name = " ")]
            string fullName,

            [FromForm]
            [Required(ErrorMessage = " ")]
            [StringLength(100, MinimumLength = 6, ErrorMessage = "     6 ")]
            [Display(Name = "")]
            string password,

            [FromForm]
            [Display(Name = "")]
            List<string> allergies = null)
        {
            try
            {
                var user = await _authService.Register(username, email, fullName, password, allergies ?? new List<string>());

                return Ok(new
                {
                    Id = user.Id,
                    Username = user.Username,
                    Email = user.Email,
                    FullName = user.FullName,
                    Message = "  "
                });
            }
            catch (Exception ex)
            {
                return BadRequest(new { error = ex.Message });
            }
        }

        [HttpPost("login")]
        public async Task<ActionResult> Login(
            [FromForm]
            [Required(ErrorMessage = "  ")]
            [Display(Name = " ")]
            string username,

            [FromForm]
            [Required(ErrorMessage = " ")]
            [Display(Name = "")]
            string password)
        {
            try
            {
                var user = await _authService.Login(username, password);

                return Ok(new
                {
                    Id = user.Id,
                    Username = user.Username,
                    Email = user.Email,
                    FullName = user.FullName,
                    Message = "  "
                });
            }
            catch (Exception ex)
            {
                return Unauthorized(new { error = ex.Message });
            }
        }
    }
}using Microsoft.AspNetCore.Mvc;
using System.Security.Claims;

namespace YP_API.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class BaseApiController : ControllerBase
    {
        protected int GetUserId()
        {
            try
            {
                var userIdClaim = User.FindFirst(ClaimTypes.NameIdentifier)?.Value
                               ?? User.FindFirst("nameid")?.Value
                               ?? User.FindFirst("sub")?.Value
                               ?? User.FindFirst("userId")?.Value;

                if (string.IsNullOrEmpty(userIdClaim))
                {
                    var allClaims = User.Claims.Select(c => $"{c.Type}: {c.Value}").ToList();
                    Console.WriteLine("Available claims: " + string.Join(", ", allClaims));

                    throw new UnauthorizedAccessException("User ID not found in token. Available claims: " + string.Join(", ", allClaims));
                }

                if (int.TryParse(userIdClaim, out int userId))
                {
                    return userId;
                }

                throw new UnauthorizedAccessException($"Invalid user ID format in token: {userIdClaim}");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error in GetUserId: {ex.Message}");
                throw;
            }
        }
    }
}﻿using Microsoft.AspNetCore.Mvc;
using System.ComponentModel.DataAnnotations;
using YP_API.Interfaces;
using YP_API.Models;

namespace YP_API.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class InventoryController : ControllerBase
    {
        private readonly IUserRepository _userRepository;
        private readonly IIngredientRepository _ingredientRepository;
        private readonly IRepository<UserInventory> _inventoryRepository;
        private readonly ILogger<InventoryController> _logger;

        public InventoryController(
            IUserRepository userRepository,
            IIngredientRepository ingredientRepository,
            IRepository<UserInventory> inventoryRepository,
            ILogger<InventoryController> logger)
        {
            _userRepository = userRepository;
            _ingredientRepository = ingredientRepository;
            _inventoryRepository = inventoryRepository;
            _logger = logger;
        }

        [HttpGet("{userId}")]
        public async Task<ActionResult> GetInventory(int userId)
        {
            try
            {
                var user = await _userRepository.GetByIdAsync(userId);
                if (user == null)
                {
                    return NotFound(new
                    {
                        success = false,
                        error = "Пользователь не найден",
                        message = $"Пользователь с ID {userId} не существует"
                    });
                }

                var inventory = await _inventoryRepository.GetAllAsync();
                var userInventory = inventory.OfType<UserInventory>()
                    .Where(ui => ui.UserId == userId)
                    .ToList();

                return Ok(new
                {
                    success = true,
                    message = "Инвентарь получен успешно",
                    data = userInventory.Select(ui => new
                    {
                        Id = ui.Id,
                        ProductName = ui.Ingredient?.Name,
                        IngredientId = ui.IngredientId,
                        Quantity = ui.Quantity,
                        Unit = ui.Unit,
                        ExpiryDate = ui.ExpiryDate,
                        AddedAt = ui.AddedAt
                    })
                });
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error in GetInventory: {ex.Message}");
                return StatusCode(500, new
                {
                    success = false,
                    error = "Внутренняя ошибка сервера",
                    message = "Ошибка при получении инвентаря"
                });
            }
        }

        [HttpPost("add/{userId}")]
        public async Task<ActionResult> AddToInventory(
            int userId,
            [FromForm]
            [Required(ErrorMessage = "Название продукта обязательно")]
            [Display(Name = "Название продукта")]
            string productName,

            [FromForm]
            [Range(0.001, 1000, ErrorMessage = "Количество должно быть от 0.001 до 1000")]
            [Display(Name = "Количество")]
            decimal quantity = 1,

            [FromForm]
            [Display(Name = "Единица измерения")]
            string unit = "шт")
        {
            try
            {
                var user = await _userRepository.GetByIdAsync(userId);
                if (user == null)
                {
                    return BadRequest(new
                    {
                        success = false,
                        error = "Пользователь не найден",
                        message = "Не удалось найти указанного пользователя"
                    });
                }

                var ingredient = await _ingredientRepository.GetIngredientByNameAsync(productName);
                if (ingredient == null)
                {
                    ingredient = new Ingredient
                    {
                        Name = productName,
                        Category = "Другое",
                        StandardUnit = unit
                    };
                    await _ingredientRepository.AddAsync(ingredient);
                    await _ingredientRepository.SaveAllAsync();
                }

                var existingInventory = (await _inventoryRepository.GetAllAsync())
                    .OfType<UserInventory>()
                    .FirstOrDefault(ui => ui.UserId == userId && ui.IngredientId == ingredient.Id);

                if (existingInventory != null)
                {
                    existingInventory.Quantity += quantity;
                    _inventoryRepository.Update(existingInventory);
                }
                else
                {
                    // Создаем новую запись
                    var inventoryItem = new UserInventory
                    {
                        UserId = userId,
                        IngredientId = ingredient.Id,
                        Quantity = quantity,
                        Unit = unit,
                        AddedAt = DateTime.UtcNow
                    };
                    await _inventoryRepository.AddAsync(inventoryItem);
                }

                if (await _inventoryRepository.SaveAllAsync())
                {
                    return Ok(new
                    {
                        success = true,
                        message = "Продукт успешно добавлен в инвентарь",
                        data = new
                        {
                            ProductName = ingredient.Name,
                            Quantity = quantity,
                            Unit = unit
                        }
                    });
                }

                return BadRequest(new
                {
                    success = false,
                    error = "Ошибка сохранения",
                    message = "Не удалось сохранить продукт в инвентарь"
                });
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error in AddToInventory: {ex.Message}");
                return BadRequest(new
                {
                    success = false,
                    error = "Ошибка добавления в инвентарь",
                    message = ex.Message
                });
            }
        }

        [HttpDelete("{userId}/items/{itemId}")]
        public async Task<ActionResult> RemoveFromInventory(int userId, int itemId)
        {
            try
            {
                var inventoryItem = await _inventoryRepository.GetByIdAsync(itemId) as UserInventory;
                if (inventoryItem == null || inventoryItem.UserId != userId)
                {
                    return NotFound(new
                    {
                        success = false,
                        error = "Элемент не найден",
                        message = "Элемент инвентаря не найден или не принадлежит пользователю"
                    });
                }

                _inventoryRepository.Delete(inventoryItem);

                if (await _inventoryRepository.SaveAllAsync())
                {
                    return Ok(new
                    {
                        success = true,
                        message = "Продукт успешно удален из инвентаря"
                    });
                }

                return BadRequest(new
                {
                    success = false,
                    error = "Ошибка удаления",
                    message = "Не удалось удалить продукт из инвентаря"
                });
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error in RemoveFromInventory: {ex.Message}");
                return BadRequest(new
                {
                    success = false,
                    error = "Ошибка удаления из инвентаря",
                    message = ex.Message
                });
            }
        }

        [HttpPut("{userId}/items/{itemId}")]
        public async Task<ActionResult> UpdateInventoryItem(
            int userId,
            int itemId,
            [FromForm]
            [Range(0.001, 1000, ErrorMessage = "Количество должно быть от 0.001 до 1000")]
            [Display(Name = "Количество")]
            decimal quantity,

            [FromForm]
            [Display(Name = "Единица измерения")]
            string unit = "шт")
        {
            try
            {
                var inventoryItem = await _inventoryRepository.GetByIdAsync(itemId) as UserInventory;
                if (inventoryItem == null || inventoryItem.UserId != userId)
                {
                    return NotFound(new
                    {
                        success = false,
                        error = "Элемент не найден",
                        message = "Элемент инвентаря не найден или не принадлежит пользователю"
                    });
                }

                inventoryItem.Quantity = quantity;
                inventoryItem.Unit = unit;

                _inventoryRepository.Update(inventoryItem);

                if (await _inventoryRepository.SaveAllAsync())
                {
                    return Ok(new
                    {
                        success = true,
                        message = "Продукт успешно обновлен",
                        data = new
                        {
                            Id = inventoryItem.Id,
                            Quantity = inventoryItem.Quantity,
                            Unit = inventoryItem.Unit
                        }
                    });
                }

                return BadRequest(new
                {
                    success = false,
                    error = "Ошибка обновления",
                    message = "Не удалось обновить продукт в инвентаре"
                });
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error in UpdateInventoryItem: {ex.Message}");
                return BadRequest(new
                {
                    success = false,
                    error = "Ошибка обновления инвентаря",
                    message = ex.Message
                });
            }
        }
    }
}using Microsoft.AspNetCore.Mvc;
using System.ComponentModel.DataAnnotations;
using YP_API.Interfaces;
using YP_API.Models;
using YP_API.Services;

namespace YP_API.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class MenuController : ControllerBase
    {
        private readonly IMenuService _menuService;
        private readonly IUserRepository _userRepository;
        private readonly IRecipeRepository _recipeRepository;
        private readonly ILogger<MenuController> _logger;

        public MenuController(IMenuService menuService, IUserRepository userRepository, IRecipeRepository recipeRepository, ILogger<MenuController> logger)
        {
            _menuService = menuService;
            _userRepository = userRepository;
            _recipeRepository = recipeRepository;
            _logger = logger;
        }

        [HttpGet("current/{userId}")]
        public async Task<ActionResult> GetCurrentMenu(int userId)
        {
            try
            {
                _logger.LogInformation($"Getting current menu for user ID: {userId}");

                var menu = await _menuService.GetCurrentMenuAsync(userId);

                if (menu == null)
                    return Ok(new
                    {
                        success = false,
                        message = "   ",
                        data = (object)null
                    });

                return Ok(new
                {
                    success = true,
                    message = " ",
                    data = new
                    {
                        Id = menu.Id,
                        Name = menu.Name,
                        StartDate = menu.StartDate,
                        EndDate = menu.EndDate,
                        TotalCalories = menu.TotalCalories,
                        Days = menu.MenuMeals?.GroupBy(m => m.MealDate).Select(g => new {
                            Date = g.Key,
                            Meals = g.Select(m => new {
                                Id = m.Id,
                                RecipeId = m.RecipeId,
                                RecipeTitle = m.Recipe?.Title,
                                MealType = m.MealType,
                                Calories = m.Recipe?.Calories,
                                PrepTime = (m.Recipe?.PrepTime ?? 0) + (m.Recipe?.CookTime ?? 0),
                                ImageUrl = m.Recipe?.ImageUrl
                            })
                        })
                    }
                });
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error in GetCurrentMenu: {ex.Message}");
                return StatusCode(500, new
                {
                    success = false,
                    error = "  ",
                    message = "    "
                });
            }
        }

        [HttpPost("generate/{userId}")]
        public async Task<ActionResult> GenerateMenu(
            int userId,
            [FromForm]
            [Range(1, 30, ErrorMessage = "     1  30")]
            [Display(Name = " ")]
            int days = 7,

            [FromForm]
            [Range(0, 10000, ErrorMessage = "    0  10000")]
            [Display(Name = "   ")]
            decimal? targetCaloriesPerDay = null,

            [FromForm]
            [Display(Name = " ")]
            List<string> cuisineTags = null,

            [FromForm]
            [Display(Name = "  ")]
            List<string> mealTypes = null,

            [FromForm]
            [Display(Name = " ")]
            bool useInventory = false)
        {
            try
            {
                _logger.LogInformation($"Generating menu for user {userId}, days: {days}, calories: {targetCaloriesPerDay}");

                var user = await _userRepository.GetByIdAsync(userId);
                if (user == null)
                {
                    return BadRequest(new
                    {
                        success = false,
                        error = "  ",
                        message = "    "
                    });
                }

                var availableRecipes = await _recipeRepository.GetRecipesForMenuAsync(
                    user.Allergies ?? new List<string>(),
                    cuisineTags ?? new List<string>(),
                    targetCaloriesPerDay);

                if (!availableRecipes.Any())
                {
                    _logger.LogWarning($"No recipes available for user {userId} with filters: allergies={user.Allergies?.Count}, cuisineTags={cuisineTags?.Count}, maxCalories={targetCaloriesPerDay}");

                    return BadRequest(new
                    {
                        success = false,
                        error = "  ",
                        message = "     .   .",
                        suggestions = new
                        {
                            tryWithoutAllergies = user.Allergies?.Any() == true,
                            tryWithoutCuisineTags = cuisineTags?.Any() == true,
                            tryHigherCalories = targetCaloriesPerDay.HasValue
                        }
                    });
                }

                var request = new GenerateMenuRequest
                {
                    Days = days,
                    TargetCaloriesPerDay = targetCaloriesPerDay,
                    CuisineTags = cuisineTags ?? new List<string>(),
                    MealTypes = mealTypes ?? new List<string> { "breakfast", "lunch", "dinner" },
                    UseInventory = useInventory
                };

                var menu = await _menuService.GenerateWeeklyMenuAsync(userId, request, user.Allergies);

                _logger.LogInformation($"Menu generated successfully: {menu.Id} with {menu.MenuMeals?.Count} meals");

                return Ok(new
                {
                    success = true,
                    message = "  ",
                    data = new
                    {
                        Id = menu.Id,
                        Name = menu.Name,
                        StartDate = menu.StartDate,
                        EndDate = menu.EndDate,
                        TotalCalories = menu.TotalCalories,
                        MealCount = menu.MenuMeals?.Count ?? 0
                    }
                });
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error in GenerateMenu: {ex.Message}");
                return BadRequest(new
                {
                    success = false,
                    error = "  ",
                    message = ex.Message
                });
            }
        }

        [HttpGet("history/{userId}")]
        public async Task<ActionResult> GetMenuHistory(int userId)
        {
            try
            {
                var menus = await _menuService.GetUserMenuHistoryAsync(userId);

                if (!menus.Any())
                {
                    return Ok(new
                    {
                        success = true,
                        message = "  ",
                        data = new List<object>()
                    });
                }

                return Ok(new
                {
                    success = true,
                    message = "  ",
                    data = menus.Select(m => new {
                        Id = m.Id,
                        Name = m.Name,
                        StartDate = m.StartDate,
                        EndDate = m.EndDate,
                        TotalCalories = m.TotalCalories,
                        CreatedAt = m.CreatedAt
                    })
                });
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error in GetMenuHistory: {ex.Message}");
                return StatusCode(500, new
                {
                    success = false,
                    error = "  ",
                    message = "    "
                });
            }
        }

        [HttpPost("{menuId}/regenerate-day")]
        public async Task<ActionResult> RegenerateDay(
            int menuId,
            [FromForm]
            [Required(ErrorMessage = " ")]
            [Display(Name = "  ")]
            DateTime date)
        {
            try
            {
                var menu = await _menuService.RegenerateDayAsync(menuId, date, null);

                return Ok(new
                {
                    success = true,
                    message = "  ",
                    data = new
                    {
                        MenuId = menu.Id,
                        Date = date
                    }
                });
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error in RegenerateDay: {ex.Message}");
                return BadRequest(new
                {
                    success = false,
                    error = " ",
                    message = ex.Message
                });
            }
        }
    }

    public class GenerateMenuRequest
    {
        public int Days { get; set; } = 7;
        public decimal? TargetCaloriesPerDay { get; set; }
        public List<string> CuisineTags { get; set; } = new List<string>();
        public List<string> MealTypes { get; set; } = new List<string> { "breakfast", "lunch", "dinner" };
        public bool UseInventory { get; set; } = false;
    }
}using Microsoft.AspNetCore.Mvc;
using System.ComponentModel.DataAnnotations;
using YP_API.Helpers;
using YP_API.Interfaces;
using YP_API.Models;

namespace YP_API.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class RecipesController : ControllerBase
    {
        private readonly IRecipeRepository _recipeRepository;
        private readonly ILogger<RecipesController> _logger;

        public RecipesController(IRecipeRepository recipeRepository, ILogger<RecipesController> logger)
        {
            _recipeRepository = recipeRepository;
            _logger = logger;
        }

        [HttpGet]
        public async Task<ActionResult> GetRecipes([FromQuery] RecipeSearchParams searchParams)
        {
            try
            {
                if (!ModelState.IsValid)
                {
                    ModelState.Remove("Difficulty");

                    if (ModelState.ErrorCount > 0)
                    {
                        var errors = ModelState
                            .Where(x => x.Key != "Difficulty" && x.Value.Errors.Count > 0)
                            .ToDictionary(
                                x => x.Key,
                                x => x.Value.Errors.Select(e => e.ErrorMessage).ToArray()
                            );

                        if (errors.Count > 0)
                        {
                            return BadRequest(new
                            {
                                success = false,
                                error = " ",
                                errors = errors
                            });
                        }
                    }
                }

                var recipes = await _recipeRepository.GetRecipesAsync(searchParams);

                Response.Headers.Add("X-Pagination", System.Text.Json.JsonSerializer.Serialize(new
                {
                    recipes.CurrentPage,
                    recipes.PageSize,
                    recipes.TotalCount,
                    recipes.TotalPages
                }));

                return Ok(new
                {
                    success = true,
                    message = "  ",
                    data = recipes.Select(r => new {
                        Id = r.Id,
                        Title = r.Title,
                        Description = r.Description,
                        PrepTime = r.PrepTime,
                        CookTime = r.CookTime,
                        Calories = r.Calories,
                        ImageUrl = r.ImageUrl,
                        Difficulty = r.Difficulty
                    })
                });
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error in GetRecipes: {ex.Message}");
                return StatusCode(500, new
                {
                    success = false,
                    error = "  ",
                    message = "    "
                });
            }
        }

        [HttpGet("{id}")]
        public async Task<ActionResult> GetRecipe(int id)
        {
            try
            {
                var recipe = await _recipeRepository.GetRecipeWithDetailsAsync(id);

                if (recipe == null)
                    return NotFound(new
                    {
                        success = false,
                        error = "  ",
                        message = $"  ID {id}  "
                    });

                return Ok(new
                {
                    success = true,
                    message = "  ",
                    data = new
                    {
                        Id = recipe.Id,
                        Title = recipe.Title,
                        Description = recipe.Description,
                        Instructions = recipe.Instructions,
                        PrepTime = recipe.PrepTime,
                        CookTime = recipe.CookTime,
                        Servings = recipe.Servings,
                        Calories = recipe.Calories,
                        ImageUrl = recipe.ImageUrl,
                        Difficulty = recipe.Difficulty,
                        CuisineType = recipe.CuisineType,
                        Ingredients = recipe.RecipeIngredients?.Select(ri => new {
                            Name = ri.Ingredient?.Name,
                            Quantity = ri.Quantity,
                            Unit = ri.Unit,
                            Category = ri.Ingredient?.Category
                        })
                    }
                });
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error in GetRecipe: {ex.Message}");
                return StatusCode(500, new
                {
                    success = false,
                    error = "  ",
                    message = "    "
                });
            }
        }

        [HttpPost]
        public async Task<ActionResult> CreateRecipe(
            [FromForm]
            [Required(ErrorMessage = "  ")]
            [Display(Name = " ")]
            string title,

            [FromForm]
            [Display(Name = " ")]
            string description,

            [FromForm]
            [Required(ErrorMessage = " ")]
            [Display(Name = " ")]
            string instructions,

            [FromForm]
            [Range(0, 1000, ErrorMessage = "     0  1000 ")]
            [Display(Name = "  ()")]
            int prepTime,

            [FromForm]
            [Range(0, 1000, ErrorMessage = "     0  1000 ")]
            [Display(Name = "  ()")]
            int cookTime,

            [FromForm]
            [Range(1, 100, ErrorMessage = "     1  100")]
            [Display(Name = " ")]
            int servings,

            [FromForm]
            [Range(0, 10000, ErrorMessage = "    0  10000")]
            [Display(Name = "")]
            decimal calories,

            [FromForm]
            [Url(ErrorMessage = " URL ")]
            [Display(Name = "URL ")]
            string imageUrl = "",

            [FromForm]
            [Display(Name = " ")]
            string cuisineType = "",

            [FromForm]
            [Display(Name = " ")]
            string difficulty = "")
        {
            try
            {
                var recipe = new Recipe
                {
                    Title = title,
                    Description = description,
                    Instructions = instructions,
                    PrepTime = prepTime,
                    CookTime = cookTime,
                    Servings = servings,
                    Calories = calories,
                    ImageUrl = imageUrl,
                    CuisineType = cuisineType,
                    Difficulty = difficulty,
                    CreatedAt = DateTime.UtcNow
                };

                await _recipeRepository.AddAsync(recipe);

                if (await _recipeRepository.SaveAllAsync())
                {
                    return Ok(new
                    {
                        success = true,
                        message = "  ",
                        data = new
                        {
                            Id = recipe.Id,
                            Title = recipe.Title
                        }
                    });
                }

                return BadRequest(new
                {
                    success = false,
                    error = "  ",
                    message = "      "
                });
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error in CreateRecipe: {ex.Message}");
                return BadRequest(new
                {
                    success = false,
                    error = "  ",
                    message = ex.Message
                });
            }
        }

        [HttpPost("{id}/favorite/{userId}")]
        public async Task<ActionResult> ToggleFavorite(int id, int userId)
        {
            try
            {
                _logger.LogInformation($"Toggling favorite for user {userId}, recipe {id}");

                var success = await _recipeRepository.ToggleFavoriteAsync(userId, id);

                if (success)
                {
                    var isFavorite = await _recipeRepository.IsRecipeFavoriteAsync(userId, id);

                    return Ok(new
                    {
                        success = true,
                        message = isFavorite ? "   " : "   ",
                        data = new
                        {
                            RecipeId = id,
                            IsFavorite = isFavorite
                        }
                    });
                }

                return BadRequest(new
                {
                    success = false,
                    error = "  ",
                    message = "    "
                });
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error in ToggleFavorite: {ex.Message}");
                _logger.LogError($"Stack trace: {ex.StackTrace}");

                return BadRequest(new
                {
                    success = false,
                    error = "  ",
                    message = ex.Message
                });
            }
        }

        [HttpGet("favorites/{userId}")]
        public async Task<ActionResult> GetFavorites(int userId)
        {
            try
            {
                var favorites = await _recipeRepository.GetUserFavoritesAsync(userId);

                return Ok(new
                {
                    success = true,
                    message = "  ",
                    data = favorites.Select(r => new {
                        Id = r.Id,
                        Title = r.Title,
                        Description = r.Description,
                        Calories = r.Calories,
                        ImageUrl = r.ImageUrl,
                        PrepTime = r.PrepTime,
                        CookTime = r.CookTime
                    })
                });
            }
            catch (Exception ex)
            {
                _logger.LogError($"Error in GetFavorites: {ex.Message}");
                return StatusCode(500, new
                {
                    success = false,
                    error = "  ",
                    message = "     "
                });
            }
        }
    }

    public class CreateRecipeIngredientRequest
    {
        public int IngredientId { get; set; }
        public decimal Quantity { get; set; }
        public string Unit { get; set; }
    }
}using Microsoft.AspNetCore.Mvc;
using System.ComponentModel.DataAnnotations;
using YP_API.Interfaces;
using YP_API.Models;
using YP_API.Services;

namespace YP_API.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class ShoppingListController : ControllerBase
    {
        private readonly IShoppingListService _shoppingListService;

        public ShoppingListController(IShoppingListService shoppingListService)
        {
            _shoppingListService = shoppingListService;
        }

        [HttpGet("current/{userId}")]
        public async Task<ActionResult> GetCurrentShoppingList(int userId)
        {
            var shoppingList = await _shoppingListService.GetCurrentShoppingListAsync(userId);

            if (shoppingList == null)
                return NotFound(new { error = "    " });

            return Ok(new
            {
                Id = shoppingList.Id,
                Name = shoppingList.Name,
                IsCompleted = shoppingList.IsCompleted,
                Items = shoppingList.Items?.Select(i => new {
                    Id = i.Id,
                    IngredientName = i.Ingredient?.Name,
                    Quantity = i.Quantity,
                    Unit = i.Unit,
                    Category = i.Category,
                    IsPurchased = i.IsPurchased
                })
            });
        }

        [HttpPost("{listId}/items/{itemId}/toggle")]
        public async Task<ActionResult> ToggleItemPurchased(
            int listId,
            int itemId,
            [FromForm]
            [Required(ErrorMessage = "  ")]
            [Display(Name = "  (/ )")]
            bool isPurchased)
        {
            var success = await _shoppingListService.ToggleItemPurchasedAsync(itemId, isPurchased);

            if (success)
                return Ok(new { message = "   " });

            return BadRequest(new { error = "    " });
        }

        [HttpPost("generate-from-menu/{menuId}/{userId}")]
        public async Task<ActionResult> GenerateFromMenu(int menuId, int userId)
        {
            try
            {
                var shoppingList = await _shoppingListService.GenerateShoppingListFromMenuAsync(menuId, userId);

                return Ok(new
                {
                    Id = shoppingList.Id,
                    Name = shoppingList.Name,
                    Message = "   ",
                    ItemsCount = shoppingList.Items?.Count ?? 0
                });
            }
            catch (Exception ex)
            {
                return BadRequest(new
                {
                    success = false,
                    error = "   ",
                    message = ex.Message
                });
            }
        }
    }
}﻿using Microsoft.AspNetCore.Mvc;
using YP_API.Interfaces;
using YP_API.Models.Dtos;

[ApiController]
[Route("api/[controller]")]
public class UserController : ControllerBase
{
    private readonly IUserRepository _userRepository;
    private readonly ILogger<UserController> _logger;

    public UserController(IUserRepository userRepository, ILogger<UserController> logger)
    {
        _userRepository = userRepository;
        _logger = logger;
    }

    [HttpGet("profile/{userId}")]
    public async Task<ActionResult> GetUserProfile(int userId)
    {
        try
        {
            var user = await _userRepository.GetByIdAsync(userId);

            if (user == null)
            {
                return NotFound(new { success = false, error = "User not found" });
            }

            var userProfile = new
            {
                Username = user.Username,
                Email = user.Email,
                FullName = user.FullName,
                CreatedAt = user.CreatedAt,
                Allergies = user.Allergies ?? new List<string>()
            };

            return Ok(userProfile);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting user profile");
            return StatusCode(500, new { success = false, error = ex.Message });
        }
    }

    [HttpPost("profile/{userId}")]
    public async Task<ActionResult> UpdateUserProfile(
        int userId,
        [FromForm] string fullName,
        [FromForm] string email)
    {
        try
        {
            var user = await _userRepository.GetByIdAsync(userId);

            if (user == null)
            {
                return NotFound(new { success = false, error = "User not found" });
            }

            user.FullName = fullName;
            user.Email = email;

            _userRepository.Update(user);
            if (await _userRepository.SaveAllAsync())
            {
                return Ok(new { success = true, message = "Profile updated" });
            }
            return BadRequest(new { success = false, error = "Failed to update profile" });
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error updating user profile");
            return StatusCode(500, new { success = false, error = ex.Message });
        }
    }

    [HttpGet("allergies/{userId}")]
    public async Task<ActionResult<List<string>>> GetUserAllergies(int userId)
    {
        try
        {
            var user = await _userRepository.GetByIdAsync(userId);

            if (user == null)
            {
                return NotFound(new { success = false, error = "User not found" });
            }

            return Ok(user.Allergies ?? new List<string>());
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting user allergies");
            return StatusCode(500, new { success = false, error = ex.Message });
        }
    }

    [HttpPost("allergies/{userId}")]
    public async Task<ActionResult> UpdateUserAllergies(
        int userId,
        [FromBody] UpdateAllergiesDto updateDto)
    {
        try
        {
            var user = await _userRepository.GetByIdAsync(userId);

            if (user == null)
            {
                return NotFound(new { success = false, error = "User not found" });
            }

            user.Allergies = updateDto.Allergies ?? new List<string>();

            _userRepository.Update(user);
            if (await _userRepository.SaveAllAsync())
            {
                return Ok(new { success = true, message = "Allergies updated" });
            }
            return BadRequest(new { success = false, error = "Failed to update allergies" });
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error updating user allergies");
            return StatusCode(500, new { success = false, error = ex.Message });
        }
    }
}using Microsoft.EntityFrameworkCore;
using YP_API.Configurations;
using YP_API.Models;

namespace YP_API.Data
{
    public class RecipePlannerContext : DbContext
    {
        public RecipePlannerContext(DbContextOptions<RecipePlannerContext> options) : base(options) { }

        public DbSet<User> Users { get; set; }
        public DbSet<Recipe> Recipes { get; set; }
        public DbSet<Ingredient> Ingredients { get; set; }
        public DbSet<WeeklyMenu> WeeklyMenus { get; set; }
        public DbSet<MenuMeal> MenuMeals { get; set; }
        public DbSet<ShoppingList> ShoppingLists { get; set; }
        public DbSet<ShoppingListItem> ShoppingListItems { get; set; }
        public DbSet<UserFavorite> UserFavorites { get; set; }
        public DbSet<UserInventory> UserInventories { get; set; }
        public DbSet<RecipeIngredient> RecipeIngredients { get; set; }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            base.OnModelCreating(modelBuilder);

            modelBuilder.Entity<User>(entity =>
            {
                entity.HasKey(u => u.Id);
                entity.Property(u => u.Username).IsRequired().HasMaxLength(50);
                entity.Property(u => u.Email).IsRequired().HasMaxLength(100);
                entity.Property(u => u.FullName).IsRequired().HasMaxLength(100);
                entity.Property(u => u.Password).IsRequired().HasMaxLength(100); // 
                entity.Property(u => u.Allergies)
                    .HasConversion(
                        v => string.Join(',', v),
                        v => v.Split(',', StringSplitOptions.RemoveEmptyEntries).ToList()
                    );
                entity.HasIndex(u => u.Username).IsUnique();
                entity.HasIndex(u => u.Email).IsUnique();
            });

            modelBuilder.Entity<Recipe>(entity =>
            {
                entity.HasKey(r => r.Id);
                entity.Property(r => r.Title).IsRequired().HasMaxLength(200);
                entity.Property(r => r.Description).HasMaxLength(1000).HasDefaultValue("");
                entity.Property(r => r.Instructions).HasColumnType("text").HasDefaultValue("");
                entity.Property(r => r.ImageUrl).HasMaxLength(500).HasDefaultValue("");
                entity.Property(r => r.Calories).HasPrecision(10, 2);
                entity.Property(r => r.CuisineType).HasMaxLength(50).HasDefaultValue("");
                entity.Property(r => r.Difficulty).HasMaxLength(20).HasDefaultValue("");

                entity.Property(r => r.Tags)
                    .HasConversion(
                        v => string.Join(',', v),
                        v => v.Split(',', StringSplitOptions.RemoveEmptyEntries).ToList()
                    );

                entity.Property(r => r.Allergens)
                    .HasConversion(
                        v => string.Join(',', v),
                        v => v.Split(',', StringSplitOptions.RemoveEmptyEntries).ToList()
                    );
            });

            modelBuilder.Entity<Ingredient>(entity =>
            {
                entity.HasKey(i => i.Id);
                entity.Property(i => i.Name).IsRequired().HasMaxLength(100);
                entity.Property(i => i.Category).IsRequired().HasMaxLength(50);
                entity.Property(i => i.StandardUnit).IsRequired().HasMaxLength(20);
                entity.Property(i => i.Allergens)
                    .HasConversion(
                        v => string.Join(',', v),
                        v => v.Split(',', StringSplitOptions.RemoveEmptyEntries).ToList()
                    );
                entity.HasIndex(i => i.Name).IsUnique();
            });

            modelBuilder.Entity<RecipeIngredient>(entity =>
            {
                entity.HasKey(ri => ri.Id);
                entity.Property(ri => ri.Quantity).HasPrecision(10, 3);
                entity.Property(ri => ri.Unit).HasMaxLength(20);

                entity.HasOne(ri => ri.Recipe)
                    .WithMany(r => r.RecipeIngredients)
                    .HasForeignKey(ri => ri.RecipeId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(ri => ri.Ingredient)
                    .WithMany(i => i.RecipeIngredients)
                    .HasForeignKey(ri => ri.IngredientId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            modelBuilder.Entity<WeeklyMenu>(entity =>
            {
                entity.HasKey(wm => wm.Id);
                entity.Property(wm => wm.Name).IsRequired().HasMaxLength(200);
                entity.Property(wm => wm.TotalCalories).HasPrecision(10, 2);

                entity.HasOne(wm => wm.User)
                    .WithMany(u => u.WeeklyMenus)
                    .HasForeignKey(wm => wm.UserId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            modelBuilder.Entity<MenuMeal>(entity =>
            {
                entity.HasKey(mm => mm.Id);

                entity.HasOne(mm => mm.WeeklyMenu)
                    .WithMany(wm => wm.MenuMeals)
                    .HasForeignKey(mm => mm.MenuId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(mm => mm.Recipe)
                    .WithMany(r => r.MenuMeals)
                    .HasForeignKey(mm => mm.RecipeId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            modelBuilder.Entity<ShoppingList>(entity =>
            {
                entity.HasKey(sl => sl.Id);
                entity.Property(sl => sl.Name).IsRequired().HasMaxLength(200);

                entity.HasOne(sl => sl.WeeklyMenu)
                    .WithOne(wm => wm.ShoppingList)
                    .HasForeignKey<ShoppingList>(sl => sl.MenuId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(sl => sl.User)
                    .WithMany(u => u.ShoppingLists)
                    .HasForeignKey(sl => sl.UserId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            modelBuilder.Entity<ShoppingListItem>(entity =>
            {
                entity.HasKey(sli => sli.Id);
                entity.Property(sli => sli.Quantity).HasPrecision(10, 3);
                entity.Property(sli => sli.Unit).HasMaxLength(20);
                entity.Property(sli => sli.Category).HasMaxLength(50);

                entity.HasOne(sli => sli.ShoppingList)
                    .WithMany(sl => sl.Items)
                    .HasForeignKey(sli => sli.ShoppingListId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(sli => sli.Ingredient)
                    .WithMany(i => i.ShoppingListItems)
                    .HasForeignKey(sli => sli.IngredientId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            modelBuilder.Entity<UserFavorite>(entity =>
            {
                entity.HasKey(uf => uf.Id);

                entity.HasOne(uf => uf.User)
                    .WithMany(u => u.Favorites)
                    .HasForeignKey(uf => uf.UserId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(uf => uf.Recipe)
                    .WithMany(r => r.Favorites)
                    .HasForeignKey(uf => uf.RecipeId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            modelBuilder.Entity<UserInventory>(entity =>
            {
                entity.HasKey(ui => ui.Id);
                entity.Property(ui => ui.Quantity).HasPrecision(10, 3);
                entity.Property(ui => ui.Unit).HasMaxLength(20);

                entity.HasOne(ui => ui.User)
                    .WithMany(u => u.Inventory)
                    .HasForeignKey(ui => ui.UserId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(ui => ui.Ingredient)
                    .WithMany(i => i.UserInventories)
                    .HasForeignKey(ui => ui.IngredientId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            modelBuilder.Entity<UserInventory>()
                .HasIndex(ui => new { ui.UserId, ui.IngredientId })
                .IsUnique();

            modelBuilder.Entity<UserFavorite>()
                .HasIndex(uf => new { uf.UserId, uf.RecipeId })
                .IsUnique();
        }
    }
}

namespace YP_API.Exceptions
{
    public class AppException : Exception
    {
        public int StatusCode { get; }
        public AppException(string message, int statusCode = 400) : base(message)
        {
            StatusCode = statusCode;
        }
    }

    public class NotFoundException : AppException
    {
        public NotFoundException(string message) : base(message, 404) { }
    }

    public class BadRequestException : AppException
    {
        public BadRequestException(string message) : base(message, 400) { }
    }

    public class UnauthorizedException : AppException
    {
        public UnauthorizedException(string message) : base(message, 401) { }
    }
}

namespace YP_API.Helpers
{
    public class PaginationParams
    {
        private const int MaxPageSize = 50;
        public int PageNumber { get; set; } = 1;

        private int _pageSize = 10;
        public int PageSize
        {
            get => _pageSize;
            set => _pageSize = (value > MaxPageSize) ? MaxPageSize : value;
        }
    }

    public class PagedList<T> : List<T>
    {
        public int CurrentPage { get; set; }
        public int TotalPages { get; set; }
        public int PageSize { get; set; }
        public int TotalCount { get; set; }

        public PagedList(IEnumerable<T> items, int count, int pageNumber, int pageSize)
        {
            CurrentPage = pageNumber;
            TotalPages = (int)Math.Ceiling(count / (double)pageSize);
            PageSize = pageSize;
            TotalCount = count;
            AddRange(items);
        }

        public static PagedList<T> Create(IEnumerable<T> source, int pageNumber, int pageSize)
        {
            var count = source.Count();
            var items = source.Skip((pageNumber - 1) * pageSize).Take(pageSize).ToList();
            return new PagedList<T>(items, count, pageNumber, pageSize);
        }
    }
}

namespace YP_API.Helpers
{
    public class RecipeSearchParams : PaginationParams
    {
        public string Name { get; set; }
        public List<string> Tags { get; set; } = new List<string>();
        public List<string> ExcludedAllergens { get; set; } = new List<string>();
        public List<string> CuisineTypes { get; set; } = new List<string>();
        public int? MaxPrepTime { get; set; }
        public int? MaxCookTime { get; set; }
        public decimal? MaxCalories { get; set; }
        public string? Difficulty { get; set; }
        public string SortBy { get; set; } = "name";
        public bool SortDescending { get; set; } = false;
    }

    public class IngredientSearchParams : PaginationParams
    {
        public string Category { get; set; }
        public string Name { get; set; }
        public bool? HasAllergens { get; set; }
        public string SortBy { get; set; } = "name";
        public bool SortDescending { get; set; } = false;
    }
}

using YP_API.Helpers;
using YP_API.Models;

namespace YP_API.Interfaces
{
    public interface IIngredientRepository : IRepository<Ingredient>
    {
        Task<PagedList<Ingredient>> GetIngredientsAsync(IngredientSearchParams searchParams);
        Task<IEnumerable<Ingredient>> SearchIngredientsAsync(string query);
        Task<IEnumerable<string>> GetCategoriesAsync();
        Task<Ingredient> GetIngredientByNameAsync(string name);
    }
}

using YP_API.Models;

namespace YP_API.Interfaces
{
    public interface IMenuRepository : IRepository<WeeklyMenu>
    {
        Task<WeeklyMenu> GetCurrentMenuAsync(int userId);
        Task<IEnumerable<WeeklyMenu>> GetUserMenusAsync(int userId);
        Task<WeeklyMenu> CreateMenuAsync(WeeklyMenu menu);
        Task<WeeklyMenu> GetMenuWithDetailsAsync(int menuId);
    }
}

using YP_API.Helpers;
using YP_API.Models;

namespace YP_API.Interfaces
{
    public interface IRecipeRepository : IRepository<Recipe>
    {
        Task<PagedList<Recipe>> GetRecipesAsync(RecipeSearchParams searchParams);
        Task<Recipe> GetRecipeWithDetailsAsync(int id);
        Task<IEnumerable<Recipe>> GetRecipesForMenuAsync(List<string> excludedAllergens, List<string> cuisineTags, decimal? maxCalories);
        Task<bool> ToggleFavoriteAsync(int userId, int recipeId);
        Task<bool> IsRecipeFavoriteAsync(int userId, int recipeId);
        Task<IEnumerable<Recipe>> GetUserFavoritesAsync(int userId);
        Task<IEnumerable<Recipe>> SearchRecipesAsync(string query, List<string> tags, List<string> excludedAllergens);
    }
}using Microsoft.EntityFrameworkCore;
using YP_API.Data;
using YP_API.Helpers;
using YP_API.Models;
using YP_API.Repositories;

namespace YP_API.Interfaces
{
    public interface IRepository<T> where T : class
    {
        Task<T> GetByIdAsync(int id);
        Task<IEnumerable<T>> GetAllAsync();
        Task AddAsync(T entity);
        void Update(T entity);
        void Delete(T entity);
        Task<bool> SaveAllAsync();
    }
}

using YP_API.Models;

namespace YP_API.Interfaces
{
    public interface IShoppingListRepository : IRepository<ShoppingList>
    {
        Task<ShoppingList> GetCurrentShoppingListAsync(int userId);
        Task<ShoppingList> GetShoppingListWithItemsAsync(int listId);
        Task<ShoppingListItem> GetShoppingListItemAsync(int itemId);
        Task<ShoppingList> GetShoppingListByUserIdAsync(int userId);
    }
}

using YP_API.Models;

namespace YP_API.Interfaces
{
    public interface IUserRepository : IRepository<User>
    {
        Task<User> GetUserByUsernameAsync(string username);
        Task<User> GetUserByEmailAsync(string email);
        Task<bool> UserExistsAsync(string username, string email);
    }
}

namespace YP_API.Models
{
    public class Ingredient
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Category { get; set; }
        public string StandardUnit { get; set; }
        public List<string> Allergens { get; set; } = new List<string>();

        public ICollection<RecipeIngredient> RecipeIngredients { get; set; } = new List<RecipeIngredient>();
        public ICollection<UserInventory> UserInventories { get; set; } = new List<UserInventory>();
        public ICollection<ShoppingListItem> ShoppingListItems { get; set; } = new List<ShoppingListItem>();
    }
}

namespace YP_API.Models
{
    public class MenuMeal
    {
        public int Id { get; set; }
        public int MenuId { get; set; }
        public int RecipeId { get; set; }
        public DateTime MealDate { get; set; }
        public MealType MealType { get; set; }

        public WeeklyMenu WeeklyMenu { get; set; }
        public Recipe Recipe { get; set; }
    }

    public enum MealType
    {
        Breakfast = 1,
        Lunch = 2,
        Dinner = 3,
        Snack = 4
    }
}

namespace YP_API.Models
{
    public class Recipe
    {
        public Recipe()
        {
            ImageUrl = string.Empty;
        }

        public int Id { get; set; }
        public string Title { get; set; }
        public string Description { get; set; }
        public string Instructions { get; set; }
        public int PrepTime { get; set; }
        public int CookTime { get; set; }
        public int Servings { get; set; }
        public decimal Calories { get; set; }
        public string ImageUrl { get; set; } = string.Empty;
        public List<string> Tags { get; set; } = new List<string>();
        public List<string> Allergens { get; set; } = new List<string>();
        public string CuisineType { get; set; }
        public string Difficulty { get; set; }
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
        public bool IsPublic { get; set; } = true;

        public ICollection<RecipeIngredient> RecipeIngredients { get; set; } = new List<RecipeIngredient>();
        public ICollection<MenuMeal> MenuMeals { get; set; } = new List<MenuMeal>();
        public ICollection<UserFavorite> Favorites { get; set; } = new List<UserFavorite>();
    }
}

namespace YP_API.Models
{
    public class RecipeIngredient
    {
        public int Id { get; set; }
        public int RecipeId { get; set; }
        public int IngredientId { get; set; }
        public decimal Quantity { get; set; }
        public string Unit { get; set; }

        public Recipe Recipe { get; set; }
        public Ingredient Ingredient { get; set; }
    }
}

namespace YP_API.Models
{
    public class ShoppingList
    {
        public int Id { get; set; }
        public int MenuId { get; set; }
        public int UserId { get; set; }
        public string Name { get; set; } = string.Empty;
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
        public bool IsCompleted { get; set; } = false;

        public WeeklyMenu WeeklyMenu { get; set; }
        public User User { get; set; }
        public ICollection<ShoppingListItem> Items { get; set; } = new List<ShoppingListItem>();
    }
    public class ShoppingListItem
    {
        public int Id { get; set; }
        public int ShoppingListId { get; set; }
        public int IngredientId { get; set; }
        public decimal Quantity { get; set; }
        public string Unit { get; set; }
        public bool IsPurchased { get; set; } = false;
        public string Category { get; set; }

        public ShoppingList ShoppingList { get; set; }
        public Ingredient Ingredient { get; set; }
    }
}

using YP_API.Models;

public class User
{
    public int Id { get; set; }
    public string Username { get; set; }
    public string Email { get; set; }
    public string FullName { get; set; }
    public string Password { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public List<string> Allergies { get; set; } = new List<string>();

    public ICollection<WeeklyMenu> WeeklyMenus { get; set; } = new List<WeeklyMenu>();
    public ICollection<ShoppingList> ShoppingLists { get; set; } = new List<ShoppingList>();
    public ICollection<UserFavorite> Favorites { get; set; } = new List<UserFavorite>();
    public ICollection<UserInventory> Inventory { get; set; } = new List<UserInventory>();
}namespace YP_API.Models
{
    public class UserFavorite
    {
        public int Id { get; set; }
        public int UserId { get; set; }
        public int RecipeId { get; set; }
        public DateTime AddedAt { get; set; } = DateTime.UtcNow;

        public User User { get; set; }
        public Recipe Recipe { get; set; }
    }
}

namespace YP_API.Models
{
    public class UserInventory
    {
        public int Id { get; set; }
        public int UserId { get; set; }
        public int IngredientId { get; set; }
        public decimal Quantity { get; set; }
        public string Unit { get; set; }
        public DateTime? ExpiryDate { get; set; }
        public DateTime AddedAt { get; set; } = DateTime.UtcNow;

        public User User { get; set; }
        public Ingredient Ingredient { get; set; }
    }
}

namespace YP_API.Models
{
    public class WeeklyMenu
    {
        public int Id { get; set; }
        public int UserId { get; set; }
        public string Name { get; set; }
        public DateTime StartDate { get; set; }
        public DateTime EndDate { get; set; }
        public decimal TotalCalories { get; set; }
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        public User User { get; set; }
        public ShoppingList ShoppingList { get; set; }
        public ICollection<MenuMeal> MenuMeals { get; set; } = new List<MenuMeal>();
    }
}

﻿namespace YP_API.Models.Dtos
{
    using System.Collections.Generic;

    public class UpdateAllergiesDto
    {
        /// <summary>
        /// Список выбранных аллергенов.
        /// </summary>
        public List<string> Allergies { get; set; } = new List<string>();
    }
}﻿namespace YP_API.Models.Dtos
{
    public class UserAuthResponse
    {
        public int Id { get; set; }
        public string Username { get; set; }
        public string Email { get; set; }
        public string FullName { get; set; }
        public string Token { get; set; }
    }
}// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETCoreApp,Version=v8.0", FrameworkDisplayName = ".NET 8.0")]
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("YP_API")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0+04f235d43c854463b383e25046f9b73cfe6b9bef")]
[assembly: System.Reflection.AssemblyProductAttribute("YP_API")]
[assembly: System.Reflection.AssemblyTitleAttribute("YP_API")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]

// Создано классом WriteCodeFragment MSBuild.

// <auto-generated/>
global using global::Microsoft.AspNetCore.Builder;
global using global::Microsoft.AspNetCore.Hosting;
global using global::Microsoft.AspNetCore.Http;
global using global::Microsoft.AspNetCore.Routing;
global using global::Microsoft.Extensions.Configuration;
global using global::Microsoft.Extensions.DependencyInjection;
global using global::Microsoft.Extensions.Hosting;
global using global::Microsoft.Extensions.Logging;
global using global::System;
global using global::System.Collections.Generic;
global using global::System.IO;
global using global::System.Linq;
global using global::System.Net.Http;
global using global::System.Net.Http.Json;
global using global::System.Threading;
global using global::System.Threading.Tasks;
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: Microsoft.AspNetCore.Mvc.ApplicationParts.ApplicationPartAttribute("Swashbuckle.AspNetCore.SwaggerGen")]

// Создано классом WriteCodeFragment MSBuild.

//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: Microsoft.AspNetCore.Mvc.ApplicationParts.ProvideApplicationPartFactoryAttribute("Microsoft.AspNetCore.Mvc.ApplicationParts.ConsolidatedAssemblyApplicationPartFact" +
    "ory, Microsoft.AspNetCore.Mvc.Razor")]

// Создано классом WriteCodeFragment MSBuild.

using System.Diagnostics;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.RazorPages;

namespace YP_API.Pages
{
    [ResponseCache(Duration = 0, Location = ResponseCacheLocation.None, NoStore = true)]
    [IgnoreAntiforgeryToken]
    public class ErrorModel : PageModel
    {
        public string? RequestId { get; set; }

        public bool ShowRequestId => !string.IsNullOrEmpty(RequestId);

        private readonly ILogger<ErrorModel> _logger;

        public ErrorModel(ILogger<ErrorModel> logger)
        {
            _logger = logger;
        }

        public void OnGet()
        {
            RequestId = Activity.Current?.Id ?? HttpContext.TraceIdentifier;
        }
    }

}

using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.RazorPages;

namespace YP_API.Pages
{
    public class IndexModel : PageModel
    {
        private readonly ILogger<IndexModel> _logger;

        public IndexModel(ILogger<IndexModel> logger)
        {
            _logger = logger;
        }

        public void OnGet()
        {

        }
    }
}

using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.RazorPages;

namespace YP_API.Pages
{
    public class PrivacyModel : PageModel
    {
        private readonly ILogger<PrivacyModel> _logger;

        public PrivacyModel(ILogger<PrivacyModel> logger)
        {
            _logger = logger;
        }

        public void OnGet()
        {
        }
    }

}

using Microsoft.EntityFrameworkCore;
using YP_API.Data;
using YP_API.Helpers;
using YP_API.Interfaces;
using YP_API.Models;

namespace YP_API.Repositories
{
    public class IngredientRepository : Repository<Ingredient>, IIngredientRepository
    {
        public IngredientRepository(RecipePlannerContext context) : base(context) { }

        public async Task<PagedList<Ingredient>> GetIngredientsAsync(IngredientSearchParams searchParams)
        {
            var query = _context.Ingredients.AsQueryable();

            if (!string.IsNullOrEmpty(searchParams.Name))
                query = query.Where(i => i.Name.Contains(searchParams.Name));

            if (!string.IsNullOrEmpty(searchParams.Category))
                query = query.Where(i => i.Category == searchParams.Category);

            if (searchParams.HasAllergens.HasValue)
                query = searchParams.HasAllergens.Value
                    ? query.Where(i => i.Allergens.Any())
                    : query.Where(i => !i.Allergens.Any());

            query = searchParams.SortBy?.ToLower() switch
            {
                "category" => searchParams.SortDescending
                    ? query.OrderByDescending(i => i.Category)
                    : query.OrderBy(i => i.Category),
                _ => searchParams.SortDescending
                    ? query.OrderByDescending(i => i.Name)
                    : query.OrderBy(i => i.Name)
            };

            var totalCount = await query.CountAsync();
            var items = await query
                .Skip((searchParams.PageNumber - 1) * searchParams.PageSize)
                .Take(searchParams.PageSize)
                .ToListAsync();

            return new PagedList<Ingredient>(items, totalCount, searchParams.PageNumber, searchParams.PageSize);
        }

        public async Task<IEnumerable<Ingredient>> SearchIngredientsAsync(string query)
        {
            return await _context.Ingredients
                .Where(i => i.Name.Contains(query))
                .OrderBy(i => i.Name)
                .Take(20)
                .ToListAsync();
        }

        public async Task<IEnumerable<string>> GetCategoriesAsync()
        {
            return await _context.Ingredients
                .Select(i => i.Category)
                .Distinct()
                .OrderBy(c => c)
                .ToListAsync();
        }

        public async Task<Ingredient> GetIngredientByNameAsync(string name)
        {
            return await _context.Ingredients
                .FirstOrDefaultAsync(i => i.Name == name);
        }
    }
}

using Microsoft.EntityFrameworkCore;
using YP_API.Data;
using YP_API.Interfaces;
using YP_API.Models;

namespace YP_API.Repositories
{
    public class MenuRepository : Repository<WeeklyMenu>, IMenuRepository
    {
        public MenuRepository(RecipePlannerContext context) : base(context) { }

        public async Task<WeeklyMenu> GetCurrentMenuAsync(int userId)
        {
            var today = DateTime.Today;
            return await _context.WeeklyMenus
                .Include(wm => wm.MenuMeals)
                    .ThenInclude(mm => mm.Recipe)
                .Where(wm => wm.UserId == userId && wm.StartDate <= today && wm.EndDate >= today)
                .OrderByDescending(wm => wm.CreatedAt)
                .FirstOrDefaultAsync();
        }

        public async Task<IEnumerable<WeeklyMenu>> GetUserMenusAsync(int userId)
        {
            return await _context.WeeklyMenus
                .Include(wm => wm.MenuMeals)
                    .ThenInclude(mm => mm.Recipe)
                .Where(wm => wm.UserId == userId)
                .OrderByDescending(wm => wm.CreatedAt)
                .Take(10)
                .ToListAsync();
        }

        public async Task<WeeklyMenu> CreateMenuAsync(WeeklyMenu menu)
        {
            await _context.WeeklyMenus.AddAsync(menu);
            return menu;
        }

        public async Task<WeeklyMenu> GetMenuWithDetailsAsync(int menuId)
        {
            return await _context.WeeklyMenus
                .Include(wm => wm.MenuMeals)
                    .ThenInclude(mm => mm.Recipe)
                        .ThenInclude(r => r.RecipeIngredients)
                            .ThenInclude(ri => ri.Ingredient)
                .FirstOrDefaultAsync(wm => wm.Id == menuId);
        }
    }
}

using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;
using YP_API.Data;
using YP_API.Helpers;
using YP_API.Interfaces;
using YP_API.Models;

namespace YP_API.Repositories
{
    public class RecipeRepository : Repository<Recipe>, IRecipeRepository
    {
        private readonly ILogger<RecipeRepository> _logger;

        public RecipeRepository(RecipePlannerContext context, ILogger<RecipeRepository> logger) : base(context)
        {
            _logger = logger;
        }

        public async Task<bool> ToggleFavoriteAsync(int userId, int recipeId)
        {
            using var transaction = await _context.Database.BeginTransactionAsync();

            try
            {
                _logger.LogInformation($"ToggleFavoriteAsync: UserId={userId}, RecipeId={recipeId}");

                var recipe = await _context.Recipes.FindAsync(recipeId);
                if (recipe == null)
                {
                    _logger.LogWarning($"Recipe {recipeId} not found");
                    throw new Exception($"  ID {recipeId}  ");
                }

                var user = await _context.Users.FindAsync(userId);
                if (user == null)
                {
                    _logger.LogWarning($"User {userId} not found");
                    throw new Exception($"  ID {userId}  ");
                }

                var existingFavorite = await _context.UserFavorites
                    .AsNoTracking()
                    .FirstOrDefaultAsync(uf => uf.UserId == userId && uf.RecipeId == recipeId);

                if (existingFavorite != null)
                {
                    _logger.LogInformation($"Removing recipe {recipeId} from favorites for user {userId}");
                    _context.UserFavorites.Remove(existingFavorite);
                }
                else
                {
                    _logger.LogInformation($"Adding recipe {recipeId} to favorites for user {userId}");
                    var favorite = new UserFavorite
                    {
                        UserId = userId,
                        RecipeId = recipeId,
                        AddedAt = DateTime.UtcNow
                    };
                    await _context.UserFavorites.AddAsync(favorite);
                }

                var result = await _context.SaveChangesAsync() > 0;

                if (result)
                {
                    await transaction.CommitAsync();
                    _logger.LogInformation($"Favorite toggled successfully for user {userId}, recipe {recipeId}");
                }
                else
                {
                    await transaction.RollbackAsync();
                    _logger.LogWarning($"Failed to save favorite changes for user {userId}, recipe {recipeId}");
                }

                return result;
            }
            catch (DbUpdateException dbEx)
            {
                await transaction.RollbackAsync();
                _logger.LogError($"Database error in ToggleFavoriteAsync: {dbEx.Message}");
                _logger.LogError($"Inner exception: {dbEx.InnerException?.Message}");

                if (dbEx.InnerException?.Message?.Contains("foreign key constraint") == true)
                {
                    throw new Exception("    .     .");
                }

                throw new Exception("     ");
            }
            catch (Exception ex)
            {
                await transaction.RollbackAsync();
                _logger.LogError($"Error in ToggleFavoriteAsync: {ex.Message}");
                _logger.LogError($"Inner exception: {ex.InnerException?.Message}");
                throw new Exception($"   : {ex.Message}");
            }
        }

        public async Task<bool> IsRecipeFavoriteAsync(int userId, int recipeId)
        {
            return await _context.UserFavorites
                .AnyAsync(uf => uf.UserId == userId && uf.RecipeId == recipeId);
        }

        public async Task<PagedList<Recipe>> GetRecipesAsync(RecipeSearchParams searchParams)
        {
            var query = _context.Recipes
                .Include(r => r.RecipeIngredients)
                    .ThenInclude(ri => ri.Ingredient)
                .AsQueryable();

            if (!string.IsNullOrEmpty(searchParams.Name))
                query = query.Where(r => r.Title.Contains(searchParams.Name));

            if (searchParams.Tags.Any())
            {
                var allRecipes = await query.ToListAsync();
                var filteredRecipes = allRecipes.Where(r => searchParams.Tags.All(t => r.Tags.Contains(t))).ToList();

                return PagedList<Recipe>.Create(
                    filteredRecipes,
                    searchParams.PageNumber,
                    searchParams.PageSize
                );
            }

            if (searchParams.ExcludedAllergens.Any())
            {
                var allRecipes = await query.ToListAsync();
                var filteredRecipes = allRecipes.Where(r => !r.Allergens.Any(a => searchParams.ExcludedAllergens.Contains(a))).ToList();

                return PagedList<Recipe>.Create(
                    filteredRecipes,
                    searchParams.PageNumber,
                    searchParams.PageSize
                );
            }

            if (!string.IsNullOrEmpty(searchParams.Difficulty) &&
                !string.IsNullOrWhiteSpace(searchParams.Difficulty) &&
                searchParams.Difficulty.ToLower() != "" &&
                searchParams.Difficulty.ToLower() != "all")
            {
                query = query.Where(r => r.Difficulty.ToLower() == searchParams.Difficulty.ToLower());
            }

            if (searchParams.MaxPrepTime.HasValue)
                query = query.Where(r => r.PrepTime <= searchParams.MaxPrepTime.Value);

            if (searchParams.MaxCookTime.HasValue)
                query = query.Where(r => r.CookTime <= searchParams.MaxCookTime.Value);

            if (searchParams.MaxCalories.HasValue)
                query = query.Where(r => r.Calories <= searchParams.MaxCalories.Value);

            if (searchParams.CuisineTypes.Any())
            {
                var allRecipes = await query.ToListAsync();
                var filteredRecipes = allRecipes.Where(r => searchParams.CuisineTypes.Contains(r.CuisineType)).ToList();

                return PagedList<Recipe>.Create(
                    filteredRecipes,
                    searchParams.PageNumber,
                    searchParams.PageSize
                );
            }

            query = searchParams.SortBy?.ToLower() switch
            {
                "calories" => searchParams.SortDescending
                    ? query.OrderByDescending(r => r.Calories)
                    : query.OrderBy(r => r.Calories),
                "time" => searchParams.SortDescending
                    ? query.OrderByDescending(r => r.PrepTime + r.CookTime)
                    : query.OrderBy(r => r.PrepTime + r.CookTime),
                "difficulty" => searchParams.SortDescending
                    ? query.OrderByDescending(r => r.Difficulty)
                    : query.OrderBy(r => r.Difficulty),
                _ => searchParams.SortDescending
                    ? query.OrderByDescending(r => r.Title)
                    : query.OrderBy(r => r.Title)
            };

            var totalCount = await query.CountAsync();
            var recipes = await query
                .Skip((searchParams.PageNumber - 1) * searchParams.PageSize)
                .Take(searchParams.PageSize)
                .ToListAsync();

            return new PagedList<Recipe>(recipes, totalCount, searchParams.PageNumber, searchParams.PageSize);
        }

        public async Task<Recipe> GetRecipeWithDetailsAsync(int id)
        {
            return await _context.Recipes
                .Include(r => r.RecipeIngredients)
                    .ThenInclude(ri => ri.Ingredient)
                .FirstOrDefaultAsync(r => r.Id == id);
        }

        public async Task<IEnumerable<Recipe>> GetRecipesForMenuAsync(List<string> excludedAllergens, List<string> cuisineTags, decimal? maxCalories)
        {
            var recipes = await _context.Recipes
                .Include(r => r.RecipeIngredients)
                    .ThenInclude(ri => ri.Ingredient)
                .Where(r => r.IsPublic)
                .ToListAsync();

            if (excludedAllergens != null && excludedAllergens.Any())
            {
                recipes = recipes.Where(r => !r.Allergens.Any(a => excludedAllergens.Contains(a))).ToList();
            }

            if (cuisineTags != null && cuisineTags.Any())
            {
                recipes = recipes.Where(r => cuisineTags.Contains(r.CuisineType)).ToList();
            }

            if (maxCalories.HasValue)
            {
                recipes = recipes.Where(r => r.Calories <= maxCalories.Value).ToList();
            }

            return recipes;
        }

        public async Task<IEnumerable<Recipe>> GetUserFavoritesAsync(int userId)
        {
            return await _context.UserFavorites
                .Where(uf => uf.UserId == userId)
                .Include(uf => uf.Recipe)
                    .ThenInclude(r => r.RecipeIngredients)
                        .ThenInclude(ri => ri.Ingredient)
                .Select(uf => uf.Recipe)
                .ToListAsync();
        }

        public async Task<IEnumerable<Recipe>> SearchRecipesAsync(string query, List<string> tags, List<string> excludedAllergens)
        {
            var searchQuery = _context.Recipes
                .Include(r => r.RecipeIngredients)
                    .ThenInclude(ri => ri.Ingredient)
                .AsQueryable();

            if (!string.IsNullOrEmpty(query))
            {
                searchQuery = searchQuery.Where(r =>
                    r.Title.Contains(query) ||
                    r.Description.Contains(query) ||
                    r.Tags.Any(t => t.Contains(query)) ||
                    r.RecipeIngredients.Any(ri => ri.Ingredient.Name.Contains(query))
                );
            }

            if (tags != null && tags.Any())
                searchQuery = searchQuery.Where(r => tags.All(t => r.Tags.Contains(t)));

            if (excludedAllergens != null && excludedAllergens.Any())
                searchQuery = searchQuery.Where(r => !r.Allergens.Any(a => excludedAllergens.Contains(a)));

            return await searchQuery.Take(50).ToListAsync();
        }
    }
}using Microsoft.EntityFrameworkCore;
using YP_API.Data;
using YP_API.Interfaces;

namespace YP_API.Repositories
{
    public class Repository<T> : IRepository<T> where T : class
    {
        protected readonly RecipePlannerContext _context;

        public Repository(RecipePlannerContext context)
        {
            _context = context;
        }

        public virtual async Task<T> GetByIdAsync(int id)
        {
            return await _context.Set<T>().FindAsync(id);
        }

        public virtual async Task<IEnumerable<T>> GetAllAsync()
        {
            return await _context.Set<T>().ToListAsync();
        }

        public virtual async Task AddAsync(T entity)
        {
            await _context.Set<T>().AddAsync(entity);
        }

        public virtual void Update(T entity)
        {
            _context.Set<T>().Update(entity);
        }

        public virtual void Delete(T entity)
        {
            _context.Set<T>().Remove(entity);
        }

        public virtual async Task<bool> SaveAllAsync()
        {
            return await _context.SaveChangesAsync() > 0;
        }
    }
}

using Microsoft.EntityFrameworkCore;
using YP_API.Data;
using YP_API.Interfaces;
using YP_API.Models;

namespace YP_API.Repositories
{
    public class ShoppingListRepository : Repository<ShoppingList>, IShoppingListRepository
    {
        public ShoppingListRepository(RecipePlannerContext context) : base(context) { }

        public async Task<ShoppingList> GetCurrentShoppingListAsync(int userId)
        {
            return await _context.ShoppingLists
                .Include(sl => sl.Items)
                    .ThenInclude(sli => sli.Ingredient)
                .Where(sl => sl.UserId == userId && !sl.IsCompleted)
                .OrderByDescending(sl => sl.CreatedAt)
                .FirstOrDefaultAsync();
        }

        public async Task<ShoppingList> GetShoppingListWithItemsAsync(int listId)
        {
            return await _context.ShoppingLists
                .Include(sl => sl.Items)
                    .ThenInclude(sli => sli.Ingredient)
                .FirstOrDefaultAsync(sl => sl.Id == listId);
        }

        public async Task<ShoppingListItem> GetShoppingListItemAsync(int itemId)
        {
            return await _context.ShoppingListItems
                .Include(sli => sli.ShoppingList)
                .FirstOrDefaultAsync(sli => sli.Id == itemId);
        }

        public async Task<ShoppingList> GetShoppingListByUserIdAsync(int userId)
        {
            try
            {
                return await _context.ShoppingLists
                    .Include(sl => sl.WeeklyMenu)
                    .Include(sl => sl.Items)
                        .ThenInclude(sli => sli.Ingredient)
                    .Where(sl => sl.UserId == userId)
                    .OrderByDescending(sl => sl.CreatedAt)
                    .FirstOrDefaultAsync();
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error in GetShoppingListByUserIdAsync: {ex.Message}");
                return null;
            }
        }
    }
}

using Microsoft.EntityFrameworkCore;
using YP_API.Data;
using YP_API.Interfaces;
using YP_API.Models;

namespace YP_API.Repositories
{
    public class UserRepository : Repository<User>, IUserRepository
    {
        public UserRepository(RecipePlannerContext context) : base(context) { }

        public async Task<User> GetUserByUsernameAsync(string username)
        {
            return await _context.Users
                .FirstOrDefaultAsync(u => u.Username == username);
        }

        public async Task<User> GetUserByEmailAsync(string email)
        {
            return await _context.Users
                .FirstOrDefaultAsync(u => u.Email == email);
        }

        public async Task<bool> UserExistsAsync(string username, string email)
        {
            return await _context.Users
                .AnyAsync(u => u.Username == username || u.Email == email);
        }
    }
}

using YP_API.Interfaces;
using YP_API.Models;

namespace YP_API.Services
{
    public class AuthService : IAuthService
    {
        private readonly IUserRepository _userRepository;

        public AuthService(IUserRepository userRepository)
        {
            _userRepository = userRepository;
        }

        public async Task<User> Register(string username, string email, string fullName, string password, List<string> allergies)
        {
            if (await _userRepository.UserExistsAsync(username, email))
                throw new Exception("   email  ");

            var user = new User
            {
                Username = username.ToLower().Trim(),
                Email = email.ToLower().Trim(),
                FullName = fullName?.Trim() ?? "",
                Password = password, //     
                Allergies = allergies ?? new List<string>(),
                CreatedAt = DateTime.UtcNow
            };

            await _userRepository.AddAsync(user);

            if (!await _userRepository.SaveAllAsync())
                throw new Exception("   ");

            return user;
        }

        public async Task<User> Login(string username, string password)
        {
            var user = await _userRepository.GetUserByUsernameAsync(username.ToLower());

            if (user == null)
                throw new Exception("  ");

            if (user.Password != password)
                throw new Exception(" ");

            return user;
        }
    }

    public interface IAuthService
    {
        Task<User> Register(string username, string email, string fullName, string password, List<string> allergies);
        Task<User> Login(string username, string password);
    }
}using YP_API.Interfaces;
using YP_API.Models;
using YP_API.Repositories;

namespace YP_API.Services
{
    public class MenuService : IMenuService
    {
        private readonly IMenuRepository _menuRepository;
        private readonly IRecipeRepository _recipeRepository;
        private readonly ILogger<MenuService> _logger;

        public MenuService(IMenuRepository menuRepository, IRecipeRepository recipeRepository, ILogger<MenuService> logger)
        {
            _menuRepository = menuRepository;
            _recipeRepository = recipeRepository;
            _logger = logger;
        }

        public async Task<WeeklyMenu> GenerateWeeklyMenuAsync(int userId, Controllers.GenerateMenuRequest request, List<string> userAllergies)
        {
            _logger.LogInformation($"Generating menu for user {userId}, days: {request.Days}");

            var availableRecipes = (await _recipeRepository.GetRecipesForMenuAsync(
                userAllergies ?? new List<string>(),
                request.CuisineTags ?? new List<string>(),
                request.TargetCaloriesPerDay)).ToList();

            _logger.LogInformation($"Found {availableRecipes.Count} available recipes");

            if (!availableRecipes.Any())
            {
                throw new Exception("No recipes available for menu generation with current filters");
            }

            var menu = new WeeklyMenu
            {
                UserId = userId,
                Name = $"  {request.Days} ",
                StartDate = DateTime.Today,
                EndDate = DateTime.Today.AddDays(request.Days - 1),
                CreatedAt = DateTime.UtcNow
            };

            var random = new Random();
            var totalCalories = 0m;
            var usedRecipeIds = new HashSet<int>();

            for (int i = 0; i < request.Days; i++)
            {
                var date = DateTime.Today.AddDays(i);

                foreach (var mealType in request.MealTypes ?? new List<string> { "breakfast", "lunch", "dinner" })
                {
                    var suitableRecipes = availableRecipes
                        .Where(r => !usedRecipeIds.Contains(r.Id))
                        .Where(r => r.Tags.Contains(mealType) || IsSuitableForMealType(r, mealType))
                        .ToList();

                    if (suitableRecipes.Any())
                    {
                        var selectedRecipe = suitableRecipes[random.Next(suitableRecipes.Count)];
                        usedRecipeIds.Add(selectedRecipe.Id);

                        menu.MenuMeals.Add(new MenuMeal
                        {
                            MealDate = date,
                            MealType = Enum.Parse<MealType>(mealType, true),
                            RecipeId = selectedRecipe.Id
                        });

                        totalCalories += selectedRecipe.Calories;
                        _logger.LogInformation($"Added {mealType}: {selectedRecipe.Title} ({selectedRecipe.Calories} cal)");
                    }
                    else
                    {
                        _logger.LogWarning($"No suitable recipes found for {mealType} on {date.ToShortDateString()}");
                    }
                }
            }

            menu.TotalCalories = totalCalories;

            var createdMenu = await _menuRepository.CreateMenuAsync(menu);
            await _menuRepository.SaveAllAsync();

            _logger.LogInformation($"Menu created successfully with ID: {createdMenu.Id}, {menu.MenuMeals.Count} meals, {totalCalories} total calories");

            return await GetMenuWithDetailsAsync(createdMenu.Id);
        }

        public async Task<WeeklyMenu> GetCurrentMenuAsync(int userId)
        {
            return await _menuRepository.GetCurrentMenuAsync(userId);
        }

        public async Task<List<WeeklyMenu>> GetUserMenuHistoryAsync(int userId)
        {
            var menus = await _menuRepository.GetUserMenusAsync(userId);
            return menus.ToList();
        }

        public async Task<WeeklyMenu> RegenerateDayAsync(int menuId, DateTime date, List<string> userAllergies)
        {
            return await _menuRepository.GetMenuWithDetailsAsync(menuId);
        }

        private async Task<WeeklyMenu> GetMenuWithDetailsAsync(int menuId)
        {
            return await _menuRepository.GetMenuWithDetailsAsync(menuId);
        }

        private bool IsSuitableForMealType(Recipe recipe, string mealType)
        {
            if (recipe.Tags == null || !recipe.Tags.Any())
                return false;

            return mealType.ToLower() switch
            {
                "breakfast" => recipe.Tags.Any(t => t.Contains("breakfast") || t.Contains("morning") || t.Contains("")),
                "lunch" => recipe.Tags.Any(t => t.Contains("lunch") || t.Contains("main") || t.Contains("")),
                "dinner" => recipe.Tags.Any(t => t.Contains("dinner") || t.Contains("main") || t.Contains("")),
                "snack" => recipe.Tags.Any(t => t.Contains("snack") || t.Contains("quick") || t.Contains("")),
                _ => false
            };
        }
    }

    public interface IMenuService
    {
        Task<WeeklyMenu> GenerateWeeklyMenuAsync(int userId, Controllers.GenerateMenuRequest request, List<string> userAllergies);
        Task<WeeklyMenu> GetCurrentMenuAsync(int userId);
        Task<List<WeeklyMenu>> GetUserMenuHistoryAsync(int userId);
        Task<WeeklyMenu> RegenerateDayAsync(int menuId, DateTime date, List<string> userAllergies);
    }
}using Microsoft.EntityFrameworkCore;
using YP_API.Interfaces;
using YP_API.Models;
using YP_API.Repositories;

namespace YP_API.Services
{
    public class ShoppingListService : IShoppingListService
    {
        private readonly IShoppingListRepository _shoppingListRepository;
        private readonly IMenuRepository _menuRepository;
        private readonly IIngredientRepository _ingredientRepository;
        private readonly IRepository<ShoppingList> _shoppingListRepo;
        private readonly IRepository<ShoppingListItem> _shoppingListItemRepo;

        public ShoppingListService(
            IShoppingListRepository shoppingListRepository,
            IMenuRepository menuRepository,
            IIngredientRepository ingredientRepository,
            IRepository<ShoppingList> shoppingListRepo,
            IRepository<ShoppingListItem> shoppingListItemRepo)
        {
            _shoppingListRepository = shoppingListRepository;
            _menuRepository = menuRepository;
            _ingredientRepository = ingredientRepository;
            _shoppingListRepo = shoppingListRepo;
            _shoppingListItemRepo = shoppingListItemRepo;
        }

        public async Task<ShoppingList> GenerateShoppingListFromMenuAsync(int menuId, int userId)
        {
            try
            {
                var menu = await _menuRepository.GetByIdAsync(menuId);
                if (menu == null)
                {
                    throw new Exception($"  ID {menuId}  ");
                }

                if (menu.UserId != userId)
                {
                    throw new Exception("   ");
                }

                var menuWithDetails = await _menuRepository.GetMenuWithDetailsAsync(menuId);
                if (menuWithDetails == null)
                {
                    throw new Exception("    ");
                }

                var shoppingList = new ShoppingList
                {
                    MenuId = menuId,
                    UserId = userId,
                    Name = $"   {menu.Name}",
                    CreatedAt = DateTime.UtcNow,
                    IsCompleted = false,
                    Items = new List<ShoppingListItem>()
                };

                var ingredientQuantities = new Dictionary<int, (decimal Quantity, string Unit, string Category)>();

                foreach (var menuMeal in menuWithDetails.MenuMeals ?? new List<MenuMeal>())
                {
                    var recipe = menuMeal.Recipe;
                    if (recipe?.RecipeIngredients == null) continue;

                    foreach (var recipeIngredient in recipe.RecipeIngredients)
                    {
                        var ingredient = recipeIngredient.Ingredient;
                        if (ingredient == null) continue;

                        if (ingredientQuantities.ContainsKey(ingredient.Id))
                        {
                            var existing = ingredientQuantities[ingredient.Id];
                            ingredientQuantities[ingredient.Id] = (
                                existing.Quantity + recipeIngredient.Quantity,
                                existing.Unit,
                                existing.Category
                            );
                        }
                        else
                        {
                            ingredientQuantities[ingredient.Id] = (
                                recipeIngredient.Quantity,
                                recipeIngredient.Unit,
                                ingredient.Category
                            );
                        }
                    }
                }

                foreach (var (ingredientId, (quantity, unit, category)) in ingredientQuantities)
                {
                    shoppingList.Items.Add(new ShoppingListItem
                    {
                        IngredientId = ingredientId,
                        Quantity = quantity,
                        Unit = unit,
                        Category = category,
                        IsPurchased = false
                    });
                }

                await _shoppingListRepository.AddAsync(shoppingList);

                var saveResult = await _shoppingListRepository.SaveAllAsync();

                if (!saveResult)
                {
                    throw new Exception("    ");
                }

                return shoppingList;
            }
            catch (Exception ex)
            {
                throw new Exception($"    : {ex.Message}");
            }
        }

        public async Task<ShoppingList> GetCurrentShoppingListAsync(int userId)
        {
            var shoppingList = await _shoppingListRepository.GetShoppingListByUserIdAsync(userId);
            return shoppingList;
        }

        public async Task<bool> ToggleItemPurchasedAsync(int itemId, bool isPurchased)
        {
            var item = await _shoppingListRepository.GetShoppingListItemAsync(itemId);
            if (item == null) return false;

            item.IsPurchased = isPurchased;
            _shoppingListRepository.Update(item.ShoppingList);
            return await _shoppingListRepository.SaveAllAsync();
        }
    }

    public interface IShoppingListService
    {
        Task<ShoppingList> GenerateShoppingListFromMenuAsync(int menuId, int userId);
        Task<ShoppingList> GetCurrentShoppingListAsync(int userId);
        Task<bool> ToggleItemPurchasedAsync(int itemId, bool isPurchased);
    }
}